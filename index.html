<html>
    <head>
        <meta charset="utf-8">
        
            <script src="lib/bindings/utils.js"></script>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/dist/vis-network.min.css" integrity="sha512-WgxfT5LWjfszlPHXRmBWHkV2eceiWTOBvrKCNbdgDYTHrT2AeLCGbF4sZlZw3UMN3WtL0tGUoIAKsu8mllg/XA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
            <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/vis-network.min.js" integrity="sha512-LnvoEWDFrqGHlHmDD2101OrLcbsfkrzoSpvtSQtxK3RMnRV0eOkhhBN2dXHKRrUU8p2DGRTk35n4O8nWSVe1mQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            
        
<center>
<h1></h1>
</center>

<!-- <link rel="stylesheet" href="../node_modules/vis/dist/vis.min.css" type="text/css" />
<script type="text/javascript" src="../node_modules/vis/dist/vis.js"> </script>-->
        <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
          crossorigin="anonymous"
        />
        <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
          crossorigin="anonymous"
        ></script>


        <center>
          <h1></h1>
        </center>
        <style type="text/css">

             #mynetwork {
                 width: 100%;
                 height: 900px;
                 background-color: #1a1a2e;
                 border: 1px solid lightgray;
                 position: relative;
                 float: left;
             }

             

             

             
        </style>
    
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #1a1a2e;
            overflow: hidden;
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 12px 20px;
            border-radius: 8px;
            color: #fff;
            font-size: 0.9em;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            animation: toastSlideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }

        .toast.hiding {
            animation: toastSlideOut 0.3s ease-in forwards;
        }

        @keyframes toastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes toastSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .toast-success { background: linear-gradient(135deg, #00c853 0%, #00a844 100%); }
        .toast-error { background: linear-gradient(135deg, #ff5252 0%, #d32f2f 100%); }
        .toast-warning { background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: #1a1a2e; }
        .toast-info { background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); }

        .toast-icon { font-size: 1.2em; }

        /* Keyboard shortcuts modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 8000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-content {
            background: #16213e;
            border-radius: 12px;
            border: 1px solid #4a4a6a;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #4a4a6a;
        }

        .modal-header h2 {
            color: #00ff88;
            margin: 0;
            font-size: 1.2em;
        }

        .modal-close {
            background: none;
            border: none;
            color: #8888aa;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
        }

        .modal-close:hover {
            color: #ffffff;
        }

        .shortcut-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #2a2a4a;
        }

        .shortcut-key {
            background: #0f0f23;
            padding: 4px 10px;
            border-radius: 4px;
            font-family: monospace;
            color: #00ff88;
            border: 1px solid #4a4a6a;
        }

        .shortcut-desc {
            color: #cccccc;
        }

        /* Filter chips */
        .filter-chips-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 0 15px 10px 15px;
            min-height: 10px;
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(0,255,136,0.15);
            border: 1px solid rgba(0,255,136,0.3);
            color: #00ff88;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75em;
            animation: chipFadeIn 0.2s ease-out;
        }

        @keyframes chipFadeIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .filter-chip-label {
            color: #8888aa;
        }

        .filter-chip-remove {
            background: none;
            border: none;
            color: #00ff88;
            cursor: pointer;
            padding: 0;
            font-size: 1.1em;
            line-height: 1;
            opacity: 0.7;
        }

        .filter-chip-remove:hover {
            opacity: 1;
        }

        /* Breadcrumb */
        .breadcrumb-bar {
            background: rgba(0,0,0,0.3);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #3a3a5a;
        }

        .breadcrumb-icon {
            color: #8888aa;
        }

        .breadcrumb-text {
            color: #cccccc;
            font-size: 0.85em;
        }

        .breadcrumb-text strong {
            color: #00ff88;
        }

        .breadcrumb-reset {
            background: none;
            border: 1px solid #4a4a6a;
            color: #8888aa;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            cursor: pointer;
            margin-left: auto;
        }

        .breadcrumb-reset:hover {
            border-color: #00ff88;
            color: #00ff88;
        }

        /* Search autocomplete */
        .search-container {
            position: relative;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #0f0f23;
            border: 1px solid #4a4a6a;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .autocomplete-dropdown.visible {
            display: block;
        }

        .autocomplete-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #2a2a4a;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: rgba(0,255,136,0.1);
        }

        .autocomplete-id {
            color: #00ff88;
            font-weight: 600;
        }

        .autocomplete-func {
            color: #8888aa;
            font-size: 0.85em;
            margin-left: 8px;
        }

        /* Main layout */
        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        .left-panel {
            width: 320px;
            min-width: 320px;
            background: linear-gradient(180deg, #16213e 0%, #1a1a2e 100%);
            border-right: 1px solid #4a4a6a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .graph-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .right-panel {
            width: 400px;
            min-width: 400px;
            background: linear-gradient(180deg, #16213e 0%, #1a1a2e 100%);
            border-left: 1px solid #4a4a6a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .panel-header {
            padding: 15px;
            border-bottom: 1px solid #4a4a6a;
            background: rgba(0,0,0,0.2);
        }

        .panel-header h2 {
            color: #00ff88;
            margin: 0;
            font-size: 1.1em;
            font-weight: 600;
        }

        .app-title {
            color: #00ff88;
            margin: 0 0 5px 0;
            font-size: 1.2em;
            font-weight: 600;
        }

        .app-subtitle {
            color: #8888aa;
            margin: 0;
            font-size: 0.8em;
        }

        /* Controls section */
        .controls-section {
            padding: 15px;
            border-bottom: 1px solid #3a3a5a;
        }

        .controls-section h3 {
            color: #00ff88;
            margin: 0 0 12px 0;
            font-size: 0.95em;
            font-weight: 600;
        }

        .control-row {
            margin-bottom: 12px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-row label {
            display: block;
            color: #8888aa;
            font-size: 0.8em;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .control-row select,
        .control-row input[type="text"] {
            width: 100%;
            background: #0f0f23;
            border: 1px solid #4a4a6a;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .control-row select:hover,
        .control-row input:hover {
            border-color: #00ff88;
        }

        .control-row select:focus,
        .control-row input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0,255,136,0.3);
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            border: none;
            color: #1a1a2e;
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85em;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,255,136,0.4);
        }

        .btn-secondary {
            background: #4a4a6a;
            color: #ffffff;
        }

        .btn-secondary:hover {
            background: #5a5a7a;
            box-shadow: none;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* Layout toggle */
        .layout-toggle {
            display: flex;
            gap: 0;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #4a4a6a;
        }

        .layout-btn {
            flex: 1;
            background: #0f0f23;
            border: none;
            color: #8888aa;
            padding: 10px 14px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layout-btn:first-child {
            border-right: 1px solid #4a4a6a;
        }

        .layout-btn:hover {
            background: #1a1a3e;
            color: #ffffff;
        }

        .layout-btn.active {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #1a1a2e;
            font-weight: 600;
        }

        /* Stats panel */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 15px;
        }

        .stat-box {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #3a3a5a;
        }

        .stat-label {
            color: #8888aa;
            font-size: 0.75em;
            margin-bottom: 4px;
        }

        .stat-value {
            color: #ffffff;
            font-size: 1.3em;
            font-weight: 600;
        }

        /* Legend */
        .legend-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .legend-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            border: 1px solid rgba(255,255,255,0.3);
            flex-shrink: 0;
        }

        .legend-item span {
            color: #cccccc;
            font-size: 0.8em;
        }

        /* Graph container */
        #mynetwork {
            flex: 1;
            background-color: #1a1a2e;
            border: none !important;
        }

        /* Hover tooltip */
        #hover-tooltip {
            position: fixed;
            background: rgba(22, 33, 62, 0.98);
            padding: 15px 18px;
            border-radius: 10px;
            color: #ffffff;
            font-size: 0.85em;
            z-index: 2000;
            border: 1px solid #4a4a6a;
            max-width: 380px;
            pointer-events: none;
            display: none;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }

        #hover-tooltip h4 {
            margin: 0 0 10px 0;
            color: #00ff88;
            font-size: 1em;
            border-bottom: 1px solid #4a4a6a;
            padding-bottom: 8px;
        }

        .tooltip-row {
            display: flex;
            margin: 5px 0;
            line-height: 1.4;
        }

        .tooltip-label {
            color: #8888aa;
            min-width: 90px;
            font-weight: 500;
            font-size: 0.9em;
        }

        .tooltip-value {
            color: #ffffff;
            flex: 1;
        }

        .tooltip-requisito {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #4a4a6a;
            line-height: 1.5;
            color: #ccccdd;
            font-size: 0.9em;
        }

        .tooltip-pinned-badge {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid #4a4a6a;
            color: #00ff88;
            font-size: 0.75em;
            text-align: center;
        }

        #hover-tooltip.pinned {
            border: 2px solid #00ff88;
            box-shadow: 0 8px 32px rgba(0,255,136,0.3);
        }

        /* Data table */
        .table-header {
            padding: 15px;
            border-bottom: 1px solid #4a4a6a;
            background: rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            color: #00ff88;
            margin: 0;
            font-size: 1em;
        }

        .table-count {
            color: #8888aa;
            font-size: 0.85em;
        }

        .table-container {
            flex: 1;
            overflow: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8em;
        }

        .data-table th {
            background: rgba(0,0,0,0.3);
            color: #8888aa;
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            border-bottom: 1px solid #4a4a6a;
        }

        .data-table td {
            padding: 8px;
            border-bottom: 1px solid #2a2a4a;
            color: #cccccc;
            vertical-align: top;
        }

        .data-table tr:hover td {
            background: rgba(0,255,136,0.05);
        }

        .data-table .id-cell {
            color: #00ff88;
            font-weight: 600;
            white-space: nowrap;
        }

        .data-table .area-cell {
            white-space: nowrap;
        }

        .data-table .func-cell {
            max-width: 200px;
        }

        /* Sortable table headers */
        .data-table th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 20px;
        }

        .data-table th.sortable:hover {
            background: rgba(0,255,136,0.1);
        }

        .data-table th .sort-indicator {
            position: absolute;
            right: 8px;
            opacity: 0.5;
        }

        .data-table th.sort-asc .sort-indicator,
        .data-table th.sort-desc .sort-indicator {
            opacity: 1;
            color: #00ff88;
        }

        .priority-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .priority-p0 {
            background: rgba(255,107,107,0.2);
            color: #ff6b6b;
        }

        .priority-p1 {
            background: rgba(255,217,61,0.2);
            color: #ffd93d;
        }

        .priority-p2 {
            background: rgba(78,205,196,0.2);
            color: #4ecdc4;
        }

        /* Statistics panel */
        .stats-panel {
            padding: 15px;
            border-bottom: 1px solid #4a4a6a;
            background: rgba(0,0,0,0.2);
        }

        .stats-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .stats-panel-header h3 {
            color: #00ff88;
            margin: 0;
            font-size: 0.95em;
        }

        .stats-toggle {
            background: none;
            border: none;
            color: #8888aa;
            cursor: pointer;
            font-size: 0.85em;
        }

        .stats-toggle:hover {
            color: #00ff88;
        }

        .stats-content {
            display: grid;
            gap: 15px;
        }

        .stats-content.collapsed {
            display: none;
        }

        .stats-section h4 {
            color: #8888aa;
            font-size: 0.8em;
            margin: 0 0 8px 0;
            font-weight: 500;
        }

        .stats-bar-container {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stats-bar-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75em;
        }

        .stats-bar-label {
            width: 80px;
            color: #cccccc;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .stats-bar-wrapper {
            flex: 1;
            background: #0f0f23;
            height: 16px;
            border-radius: 3px;
            overflow: hidden;
        }

        .stats-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .stats-bar-value {
            width: 30px;
            text-align: right;
            color: #8888aa;
        }

        .top-connected-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .top-connected-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75em;
            padding: 4px 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            cursor: pointer;
        }

        .top-connected-item:hover {
            background: rgba(0,255,136,0.1);
        }

        .top-connected-id {
            color: #00ff88;
            font-weight: 600;
        }

        .top-connected-count {
            color: #8888aa;
            margin-left: auto;
        }

        /* Export buttons */
        .export-section {
            padding: 10px 15px;
            border-bottom: 1px solid #3a3a5a;
            display: flex;
            gap: 8px;
        }

        .btn-export {
            flex: 1;
            background: #2a2a4a;
            border: 1px solid #4a4a6a;
            color: #cccccc;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .btn-export:hover {
            background: #3a3a5a;
            border-color: #00ff88;
            color: #00ff88;
        }

        /* Cycle warning */
        .cycle-warning {
            background: rgba(255,107,107,0.1);
            border: 1px solid rgba(255,107,107,0.3);
            color: #ff6b6b;
            padding: 10px 15px;
            margin: 10px 15px;
            border-radius: 6px;
            font-size: 0.8em;
            display: none;
        }

        .cycle-warning.visible {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cycle-warning-icon {
            font-size: 1.2em;
        }

        .cycle-warning-text {
            flex: 1;
        }

        .cycle-warning-btn {
            background: none;
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .cycle-warning-btn:hover {
            background: rgba(255,107,107,0.2);
        }

        /* Hide pyvis default elements */
        center, h1:empty {
            display: none !important;
        }

        .card {
            border: none !important;
            background: transparent !important;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a4a6a;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #5a5a7a;
        }
    </style>
    </head>


    <body>
    <div class="toast-container" id="toast-container"></div>

    <!-- Keyboard shortcuts modal -->
    <div class="modal-overlay" id="shortcuts-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚å®Ô∏è Atajos de Teclado</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">?</span>
                <span class="shortcut-desc">Mostrar/ocultar esta ayuda</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">Esc</span>
                <span class="shortcut-desc">Restablecer vista / cerrar modal</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">/</span>
                <span class="shortcut-desc">Enfocar campo de b√∫squeda</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">R</span>
                <span class="shortcut-desc">Restablecer vista</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">1</span>
                <span class="shortcut-desc">Disposici√≥n de fuerza</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">2</span>
                <span class="shortcut-desc">Disposici√≥n de √°rbol</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">A</span>
                <span class="shortcut-desc">Mostrar ancestros (nodo seleccionado)</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">D</span>
                <span class="shortcut-desc">Mostrar descendientes (nodo seleccionado)</span>
            </div>
            <div class="shortcut-row">
                <span class="shortcut-key">N</span>
                <span class="shortcut-desc">Mostrar vecindario (nodo seleccionado)</span>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Left Panel: Controls -->
        <div class="left-panel">
            <div class="panel-header">
                <h1 class="app-title">üìä Requirements Dependency Graph</h1>
                <p class="app-subtitle">Grafo interactivo de dependencias <button id="btn-shortcuts" style="background:none;border:none;color:#8888aa;cursor:pointer;font-size:0.9em;padding:2px 6px;" title="Atajos de teclado">‚å®Ô∏è ?</button></p>
            </div>

            <div class="controls-section">
                <h3>üîç Buscar Nodo</h3>
                <div class="control-row search-container">
                    <label>ID o texto del Requisito:</label>
                    <input type="text" id="node-search" placeholder="Ej: RM-001, autenticaci√≥n..." autocomplete="off">
                    <div class="autocomplete-dropdown" id="autocomplete-dropdown"></div>
                </div>
                <button class="btn" id="btn-search">Buscar y Enfocar</button>
            </div>

            <div class="controls-section">
                <h3>üéõÔ∏è Filtros</h3>
                <div class="control-row">
                    <label>√Årea:</label>
                    <select id="area-filter">
                        <option value="">‚Äî Todas las √°reas ‚Äî</option>
                        <option value="Auditabilidad">Auditabilidad</option><option value="Calidad de datos">Calidad de datos</option><option value="Dashboard">Dashboard</option><option value="DevOps">DevOps</option><option value="Documentaci√≥n">Documentaci√≥n</option><option value="Entregables">Entregables</option><option value="Exportaci√≥n">Exportaci√≥n</option><option value="Extensibilidad">Extensibilidad</option><option value="Extracci√≥n">Extracci√≥n</option><option value="Gesti√≥n de capital">Gesti√≥n de capital</option><option value="Gesti√≥n de riesgos">Gesti√≥n de riesgos</option><option value="Gobernanza">Gobernanza</option><option value="Gobernanza de datos">Gobernanza de datos</option><option value="Ingesta">Ingesta</option><option value="Integraciones">Integraciones</option><option value="Modelo de datos">Modelo de datos</option><option value="M√©tricas">M√©tricas</option><option value="Observabilidad">Observabilidad</option><option value="Performance">Performance</option><option value="Privacidad">Privacidad</option><option value="Reportes">Reportes</option><option value="Reproducibilidad">Reproducibilidad</option><option value="Seguimiento">Seguimiento</option><option value="Seguridad">Seguridad</option><option value="Testing">Testing</option><option value="Transformaci√≥n">Transformaci√≥n</option><option value="UX">UX</option><option value="Validaci√≥n de algoritmo">Validaci√≥n de algoritmo</option>
                    </select>
                </div>
                <div class="control-row">
                    <label>Prioridad:</label>
                    <select id="priority-filter">
                        <option value="">‚Äî Todas las prioridades ‚Äî</option>
                        <option value="Alta (P0)">Alta (P0)</option><option value="Media (P1)">Media (P1)</option><option value="Baja (P2)">Baja (P2)</option>
                    </select>
                </div>
                <div class="control-row">
                    <label>Versi√≥n:</label>
                    <select id="version-filter">
                        <option value="">‚Äî Todas las versiones ‚Äî</option>
                        <option value="MVP v0.1">MVP v0.1</option><option value="v0.2">v0.2</option><option value="v0.3">v0.3</option>
                    </select>
                </div>
            </div>
            <div class="filter-chips-container" id="filter-chips"></div>

            <div class="controls-section">
                <h3>üîó Explorar Conexiones</h3>
                <p style="color: #8888aa; font-size: 0.8em; margin: 0 0 10px 0;">Primero selecciona un nodo en el grafo</p>
                <div class="btn-group">
                    <button class="btn btn-secondary" id="btn-ancestors">‚Üê Dependencias</button>
                    <button class="btn btn-secondary" id="btn-descendants">Dependientes ‚Üí</button>
                </div>
                <button class="btn btn-secondary" id="btn-neighborhood" style="margin-top: 8px;">Vecindario Completo</button>
            </div>

            <div class="controls-section">
                <h3>üìê Disposici√≥n</h3>
                <div class="layout-toggle">
                    <button class="layout-btn active" id="layout-force">Fuerza</button>
                    <button class="layout-btn" id="layout-tree">√Årbol</button>
                </div>
            </div>

            <div class="controls-section">
                <button class="btn btn-secondary" id="btn-reset">üîÑ Restablecer Vista</button>
            </div>

            <div class="cycle-warning" id="cycle-warning">
                <span class="cycle-warning-icon">‚ö†Ô∏è</span>
                <span class="cycle-warning-text">Se detectaron dependencias circulares</span>
                <button class="cycle-warning-btn" id="btn-show-cycles">Ver ciclos</button>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Nodos Visibles</div>
                    <div class="stat-value" id="visible-nodes">55</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Conexiones</div>
                    <div class="stat-value" id="visible-edges">166</div>
                </div>
            </div>

            <div class="panel-header">
                <h2>üé® Leyenda de √Åreas</h2>
            </div>
            <div class="legend-container">
                <div class="legend-item" data-area="Auditabilidad"><div class="legend-color" style="background: #F9E79F"></div><span>Auditabilidad</span></div><div class="legend-item" data-area="Calidad de datos"><div class="legend-color" style="background: #82E0AA"></div><span>Calidad de datos</span></div><div class="legend-item" data-area="Dashboard"><div class="legend-color" style="background: #85C1E9"></div><span>Dashboard</span></div><div class="legend-item" data-area="DevOps"><div class="legend-color" style="background: #AED6F1"></div><span>DevOps</span></div><div class="legend-item" data-area="Documentaci√≥n"><div class="legend-color" style="background: #D5DBDB"></div><span>Documentaci√≥n</span></div><div class="legend-item" data-area="Entregables"><div class="legend-color" style="background: #FAD7A0"></div><span>Entregables</span></div><div class="legend-item" data-area="Exportaci√≥n"><div class="legend-color" style="background: #D2B4DE"></div><span>Exportaci√≥n</span></div><div class="legend-item" data-area="Extensibilidad"><div class="legend-color" style="background: #A9DFBF"></div><span>Extensibilidad</span></div><div class="legend-item" data-area="Extracci√≥n"><div class="legend-color" style="background: #FF6B6B"></div><span>Extracci√≥n</span></div><div class="legend-item" data-area="Gesti√≥n de capital"><div class="legend-color" style="background: #888"></div><span>Gesti√≥n de capital</span></div><div class="legend-item" data-area="Gesti√≥n de riesgos"><div class="legend-color" style="background: #888"></div><span>Gesti√≥n de riesgos</span></div><div class="legend-item" data-area="Gobernanza"><div class="legend-color" style="background: #D7BDE2"></div><span>Gobernanza</span></div><div class="legend-item" data-area="Gobernanza de datos"><div class="legend-color" style="background: #D7BDE2"></div><span>Gobernanza de datos</span></div><div class="legend-item" data-area="Ingesta"><div class="legend-color" style="background: #4ECDC4"></div><span>Ingesta</span></div><div class="legend-item" data-area="Integraciones"><div class="legend-color" style="background: #888"></div><span>Integraciones</span></div><div class="legend-item" data-area="Modelo de datos"><div class="legend-color" style="background: #45B7D1"></div><span>Modelo de datos</span></div><div class="legend-item" data-area="M√©tricas"><div class="legend-color" style="background: #FFD93D"></div><span>M√©tricas</span></div><div class="legend-item" data-area="Observabilidad"><div class="legend-color" style="background: #ABEBC6"></div><span>Observabilidad</span></div><div class="legend-item" data-area="Performance"><div class="legend-color" style="background: #F5CBA7"></div><span>Performance</span></div><div class="legend-item" data-area="Privacidad"><div class="legend-color" style="background: #FADBD8"></div><span>Privacidad</span></div><div class="legend-item" data-area="Reportes"><div class="legend-color" style="background: #BB8FCE"></div><span>Reportes</span></div><div class="legend-item" data-area="Reproducibilidad"><div class="legend-color" style="background: #AEB6BF"></div><span>Reproducibilidad</span></div><div class="legend-item" data-area="Seguimiento"><div class="legend-color" style="background: #888"></div><span>Seguimiento</span></div><div class="legend-item" data-area="Seguridad"><div class="legend-color" style="background: #F1948A"></div><span>Seguridad</span></div><div class="legend-item" data-area="Testing"><div class="legend-color" style="background: #F5B041"></div><span>Testing</span></div><div class="legend-item" data-area="Transformaci√≥n"><div class="legend-color" style="background: #96CEB4"></div><span>Transformaci√≥n</span></div><div class="legend-item" data-area="UX"><div class="legend-color" style="background: #85C1E9"></div><span>UX</span></div><div class="legend-item" data-area="Validaci√≥n de algoritmo"><div class="legend-color" style="background: #76D7C4"></div><span>Validaci√≥n de algoritmo</span></div>
            </div>
        </div>

        <!-- Center: Graph -->
        <div class="graph-panel">
            <div class="breadcrumb-bar" id="breadcrumb-bar">
                <span class="breadcrumb-icon">üìç</span>
                <span class="breadcrumb-text" id="breadcrumb-text">Todos los requisitos (<strong>55</strong>)</span>
                <button class="breadcrumb-reset" id="breadcrumb-reset" style="display:none;">Mostrar todos</button>
            </div>
            <div id="mynetwork"></div>
        </div>

        <!-- Right Panel: Data Table -->
        <div class="right-panel">
            <div class="export-section">
                <button class="btn-export" id="btn-export-png">
                    <span>üì∑</span> Exportar PNG
                </button>
                <button class="btn-export" id="btn-export-csv">
                    <span>üìÑ</span> Exportar CSV
                </button>
            </div>

            <div class="stats-panel" id="stats-panel">
                <div class="stats-panel-header">
                    <h3>üìä Estad√≠sticas</h3>
                    <button class="stats-toggle" id="stats-toggle">‚ñº</button>
                </div>
                <div class="stats-content" id="stats-content">
                    <div class="stats-section">
                        <h4>Por Prioridad</h4>
                        <div class="stats-bar-container" id="priority-stats"></div>
                    </div>
                    <div class="stats-section">
                        <h4>Top √Åreas</h4>
                        <div class="stats-bar-container" id="area-stats"></div>
                    </div>
                    <div class="stats-section">
                        <h4>M√°s Conectados</h4>
                        <div class="top-connected-list" id="top-connected"></div>
                    </div>
                </div>
            </div>

            <div class="table-header">
                <h2>üìã Requisitos Visibles</h2>
                <span class="table-count" id="table-count">55 requisitos</span>
            </div>
            <div class="table-container">
                <table class="data-table" id="data-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="id">ID <span class="sort-indicator">‚áÖ</span></th>
                            <th class="sortable" data-sort="area">√Årea <span class="sort-indicator">‚áÖ</span></th>
                            <th class="sortable" data-sort="funcionalidad">Funcionalidad <span class="sort-indicator">‚áÖ</span></th>
                            <th class="sortable" data-sort="prioridad">Prioridad <span class="sort-indicator">‚áÖ</span></th>
                            <th class="sortable" data-sort="version">Versi√≥n <span class="sort-indicator">‚áÖ</span></th>
                            <th class="sortable" data-sort="connections">Conex. <span class="sort-indicator">‚áÖ</span></th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="hover-tooltip"></div>
    <script type="text/javascript">

              // initialize global variables.
              var edges;
              var nodes;
              var allNodes;
              var allEdges;
              var nodeColors;
              var originalNodes;
              var network;
              var container;
              var options, data;
              var filter = {
                  item : '',
                  property : '',
                  value : []
              };

              

              

              // This method is responsible for drawing the graph, returns the drawn network
              function drawGraph() {
                  var container = document.getElementById('mynetwork');

                  

                  // parsing and collecting nodes and edges from the python
                  nodes = new vis.DataSet([{"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Ingesta", "id": "RM-001", "label": "RM-001", "level": 0, "shape": "dot", "size": 35, "title": "RM-001: Registro de traders y fuentes de desempe\u00f1o"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Ingesta", "id": "RM-002", "label": "RM-002", "level": 1, "shape": "dot", "size": 35, "title": "RM-002: Validaci\u00f3n de fuentes y credenciales (URL + MT4/MT5)"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Ingesta", "id": "RM-003", "label": "RM-003", "level": 2, "shape": "dot", "size": 25, "title": "RM-003: Pol\u00edticas de acceso por dominio (robots/ToS)"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Ingesta", "id": "RM-004", "label": "RM-004", "level": 1, "shape": "dot", "size": 35, "title": "RM-004: Scheduler de syncs"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Ingesta", "id": "RM-005", "label": "RM-005", "level": 1, "shape": "dot", "size": 35, "title": "RM-005: Rate limiting, retries y circuit breaker"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Extracci\u00f3n", "id": "RM-006", "label": "RM-006", "level": 2, "shape": "dot", "size": 35, "title": "RM-006: Adaptadores por fuente (MyFXBook / ForexFactory / HTML) y extracci\u00f3n mantenible"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Extracci\u00f3n", "id": "RM-007", "label": "RM-007", "level": 1, "shape": "dot", "size": 25, "title": "RM-007: Soporte JSON/API cuando exista"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Extracci\u00f3n", "id": "RM-008", "label": "RM-008", "level": 2, "shape": "dot", "size": 18, "title": "RM-008: Soporte de reportes de broker (PDF/XLS) y adjuntos"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Modelo de datos", "id": "RM-009", "label": "RM-009", "level": 1, "shape": "dot", "size": 35, "title": "RM-009: Almacenamiento de datos crudos versionados"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Modelo de datos", "id": "RM-010", "label": "RM-010", "level": 1, "shape": "dot", "size": 35, "title": "RM-010: Entidades normalizadas y snapshots"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Transformaci\u00f3n", "id": "RM-011", "label": "RM-011", "level": 1, "shape": "dot", "size": 35, "title": "RM-011: Reglas de mapeo configurables"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Transformaci\u00f3n", "id": "RM-012", "label": "RM-012", "level": 1, "shape": "dot", "size": 35, "title": "RM-012: Limpieza y estandarizaci\u00f3n de datos"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "M\u00e9tricas", "id": "RM-013", "label": "RM-013", "level": 1, "shape": "dot", "size": 35, "title": "RM-013: Cat\u00e1logo de definiciones de m\u00e9tricas"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "M\u00e9tricas", "id": "RM-014", "label": "RM-014", "level": 1, "shape": "dot", "size": 35, "title": "RM-014: C\u00e1lculo de m\u00e9tricas core"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "M\u00e9tricas", "id": "RM-015", "label": "RM-015", "level": 1, "shape": "dot", "size": 25, "title": "RM-015: M\u00e9tricas de costos/fees"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "M\u00e9tricas", "id": "RM-016", "label": "RM-016", "level": 2, "shape": "dot", "size": 18, "title": "RM-016: Flags de riesgo/compliance basados en reglas"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "M\u00e9tricas", "id": "RM-017", "label": "RM-017", "level": 1, "shape": "dot", "size": 35, "title": "RM-017: Benchmarks, percentiles y rankings"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Calidad de datos", "id": "RM-018", "label": "RM-018", "level": 2, "shape": "dot", "size": 35, "title": "RM-018: Score de completitud"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Calidad de datos", "id": "RM-019", "label": "RM-019", "level": 3, "shape": "dot", "size": 25, "title": "RM-019: Detecci\u00f3n de anomal\u00edas"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Auditabilidad", "id": "RM-020", "label": "RM-020", "level": 2, "shape": "dot", "size": 35, "title": "RM-020: Lineage de m\u00e9tricas a raw data"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Validaci\u00f3n de algoritmo", "id": "RM-021", "label": "RM-021", "level": 1, "shape": "dot", "size": 35, "title": "RM-021: Contrato de integraci\u00f3n del algoritmo"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Validaci\u00f3n de algoritmo", "id": "RM-022", "label": "RM-022", "level": 1, "shape": "dot", "size": 35, "title": "RM-022: Constructor de datasets (feature matrix)"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Validaci\u00f3n de algoritmo", "id": "RM-023", "label": "RM-023", "level": 2, "shape": "dot", "size": 35, "title": "RM-023: Runner de backtests/experimentos"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Validaci\u00f3n de algoritmo", "id": "RM-024", "label": "RM-024", "level": 2, "shape": "dot", "size": 35, "title": "RM-024: M\u00e9tricas de evaluaci\u00f3n y scorecards"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Validaci\u00f3n de algoritmo", "id": "RM-025", "label": "RM-025", "level": 2, "shape": "dot", "size": 25, "title": "RM-025: Diagn\u00f3sticos y sensibilidad"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Validaci\u00f3n de algoritmo", "id": "RM-026", "label": "RM-026", "level": 1, "shape": "dot", "size": 25, "title": "RM-026: What-if y parameter sweeps"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Reportes", "id": "RM-027", "label": "RM-027", "level": 3, "shape": "dot", "size": 35, "title": "RM-027: Plantillas y generaci\u00f3n de reportes"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Reportes", "id": "RM-028", "label": "RM-028", "level": 3, "shape": "dot", "size": 18, "title": "RM-028: Distribuci\u00f3n programada"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Dashboard", "id": "RM-029", "label": "RM-029", "level": 5, "shape": "dot", "size": 35, "title": "RM-029: Vistas core del dashboard"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Dashboard", "id": "RM-030", "label": "RM-030", "level": 4, "shape": "dot", "size": 35, "title": "RM-030: Comparaciones y rankings"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Dashboard", "id": "RM-031", "label": "RM-031", "level": 3, "shape": "dot", "size": 25, "title": "RM-031: Explorador de runs/experimentos"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Exportaci\u00f3n", "id": "RM-032", "label": "RM-032", "level": 3, "shape": "dot", "size": 35, "title": "RM-032: Exports de datos y resultados"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Seguridad", "id": "RM-033", "label": "RM-033", "level": 0, "shape": "dot", "size": 35, "title": "RM-033: Autenticaci\u00f3n"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Seguridad", "id": "RM-034", "label": "RM-034", "level": 1, "shape": "dot", "size": 35, "title": "RM-034: Autorizaci\u00f3n y roles (RBAC)"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Seguridad", "id": "RM-035", "label": "RM-035", "level": 1, "shape": "dot", "size": 35, "title": "RM-035: Gesti\u00f3n de secretos"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Observabilidad", "id": "RM-036", "label": "RM-036", "level": 2, "shape": "dot", "size": 35, "title": "RM-036: Logging estructurado con correlaci\u00f3n"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Observabilidad", "id": "RM-037", "label": "RM-037", "level": 1, "shape": "dot", "size": 25, "title": "RM-037: M\u00e9tricas y alertas operativas"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Performance", "id": "RM-038", "label": "RM-038", "level": 2, "shape": "dot", "size": 35, "title": "RM-038: Throughput del pipeline"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Performance", "id": "RM-039", "label": "RM-039", "level": 2, "shape": "dot", "size": 25, "title": "RM-039: Responsividad del dashboard"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Reproducibilidad", "id": "RM-040", "label": "RM-040", "level": 5, "shape": "dot", "size": 35, "title": "RM-040: Versionado end-to-end de componentes"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Testing", "id": "RM-041", "label": "RM-041", "level": 3, "shape": "dot", "size": 35, "title": "RM-041: Suite de unit/integration/E2E"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Testing", "id": "RM-042", "label": "RM-042", "level": 3, "shape": "dot", "size": 35, "title": "RM-042: Data contract tests (schemas)"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "DevOps", "id": "RM-043", "label": "RM-043", "level": 2, "shape": "dot", "size": 35, "title": "RM-043: CI/CD + migraciones + rollback"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Gobernanza de datos", "id": "RM-044", "label": "RM-044", "level": 3, "shape": "dot", "size": 25, "title": "RM-044: Retenci\u00f3n y archivado"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Gobernanza", "id": "RM-045", "label": "RM-045", "level": 1, "shape": "dot", "size": 35, "title": "RM-045: Bit\u00e1cora de auditor\u00eda de acciones cr\u00edticas"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "UX", "id": "RM-046", "label": "RM-046", "level": 3, "shape": "dot", "size": 25, "title": "RM-046: Transparencia de errores y remediaci\u00f3n"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Privacidad", "id": "RM-047", "label": "RM-047", "level": 2, "shape": "dot", "size": 18, "title": "RM-047: Minimizaci\u00f3n y redacci\u00f3n de datos"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Documentaci\u00f3n", "id": "RM-048", "label": "RM-048", "level": 1, "shape": "dot", "size": 35, "title": "RM-048: Docs t\u00e9cnicas y operativas"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Extensibilidad", "id": "RM-049", "label": "RM-049", "level": 3, "shape": "dot", "size": 25, "title": "RM-049: Onboarding de nuevo dominio/fuente"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Entregables", "id": "RM-050", "label": "RM-050", "level": 49, "shape": "dot", "size": 35, "title": "RM-050: Criterio de aceptaci\u00f3n del MVP"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Gesti\u00f3n de capital", "id": "RM-051", "label": "RM-051", "level": 3, "shape": "dot", "size": 35, "title": "RM-051: Registro de clientes y paquetes de capital"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Gesti\u00f3n de riesgos", "id": "RM-052", "label": "RM-052", "level": 6, "shape": "dot", "size": 35, "title": "RM-052: Modelo/ecuaci\u00f3n de distribuci\u00f3n de capital"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Seguimiento", "id": "RM-053", "label": "RM-053", "level": 5, "shape": "dot", "size": 35, "title": "RM-053: Seguimiento post-inversi\u00f3n de tesis de inversi\u00f3n"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Integraciones", "id": "RM-054", "label": "RM-054", "level": 6, "shape": "dot", "size": 35, "title": "RM-054: Conector MyFXBook (sync de summaries)"}, {"borderWidth": 2, "font": {"color": "#ffffff"}, "group": "Integraciones", "id": "RM-055", "label": "RM-055", "level": 5, "shape": "dot", "size": 35, "title": "RM-055: Conector MetaTrader 4/5 (modo inversionista)"}]);
                  edges = new vis.DataSet([{"arrows": "to", "from": "RM-001", "to": "RM-002"}, {"arrows": "to", "from": "RM-001", "to": "RM-003"}, {"arrows": "to", "from": "RM-001", "to": "RM-004"}, {"arrows": "to", "from": "RM-001", "to": "RM-050"}, {"arrows": "to", "from": "RM-001", "to": "RM-051"}, {"arrows": "to", "from": "RM-001", "to": "RM-054"}, {"arrows": "to", "from": "RM-001", "to": "RM-055"}, {"arrows": "to", "from": "RM-002", "to": "RM-003"}, {"arrows": "to", "from": "RM-002", "to": "RM-050"}, {"arrows": "to", "from": "RM-002", "to": "RM-054"}, {"arrows": "to", "from": "RM-002", "to": "RM-055"}, {"arrows": "to", "from": "RM-003", "to": "RM-005"}, {"arrows": "to", "from": "RM-003", "to": "RM-008"}, {"arrows": "to", "from": "RM-003", "to": "RM-050"}, {"arrows": "to", "from": "RM-004", "to": "RM-006"}, {"arrows": "to", "from": "RM-004", "to": "RM-028"}, {"arrows": "to", "from": "RM-004", "to": "RM-036"}, {"arrows": "to", "from": "RM-004", "to": "RM-038"}, {"arrows": "to", "from": "RM-004", "to": "RM-050"}, {"arrows": "to", "from": "RM-004", "to": "RM-053"}, {"arrows": "to", "from": "RM-004", "to": "RM-054"}, {"arrows": "to", "from": "RM-004", "to": "RM-055"}, {"arrows": "to", "from": "RM-005", "to": "RM-006"}, {"arrows": "to", "from": "RM-005", "to": "RM-038"}, {"arrows": "to", "from": "RM-005", "to": "RM-050"}, {"arrows": "to", "from": "RM-005", "to": "RM-054"}, {"arrows": "to", "from": "RM-006", "to": "RM-007"}, {"arrows": "to", "from": "RM-006", "to": "RM-008"}, {"arrows": "to", "from": "RM-006", "to": "RM-009"}, {"arrows": "to", "from": "RM-006", "to": "RM-041"}, {"arrows": "to", "from": "RM-006", "to": "RM-049"}, {"arrows": "to", "from": "RM-006", "to": "RM-050"}, {"arrows": "to", "from": "RM-006", "to": "RM-054"}, {"arrows": "to", "from": "RM-007", "to": "RM-050"}, {"arrows": "to", "from": "RM-008", "to": "RM-050"}, {"arrows": "to", "from": "RM-009", "to": "RM-010"}, {"arrows": "to", "from": "RM-009", "to": "RM-019"}, {"arrows": "to", "from": "RM-009", "to": "RM-020"}, {"arrows": "to", "from": "RM-009", "to": "RM-040"}, {"arrows": "to", "from": "RM-009", "to": "RM-044"}, {"arrows": "to", "from": "RM-009", "to": "RM-050"}, {"arrows": "to", "from": "RM-009", "to": "RM-054"}, {"arrows": "to", "from": "RM-009", "to": "RM-055"}, {"arrows": "to", "from": "RM-010", "to": "RM-011"}, {"arrows": "to", "from": "RM-010", "to": "RM-013"}, {"arrows": "to", "from": "RM-010", "to": "RM-022"}, {"arrows": "to", "from": "RM-010", "to": "RM-032"}, {"arrows": "to", "from": "RM-010", "to": "RM-042"}, {"arrows": "to", "from": "RM-010", "to": "RM-050"}, {"arrows": "to", "from": "RM-010", "to": "RM-055"}, {"arrows": "to", "from": "RM-011", "to": "RM-012"}, {"arrows": "to", "from": "RM-011", "to": "RM-019"}, {"arrows": "to", "from": "RM-011", "to": "RM-040"}, {"arrows": "to", "from": "RM-011", "to": "RM-049"}, {"arrows": "to", "from": "RM-011", "to": "RM-050"}, {"arrows": "to", "from": "RM-012", "to": "RM-050"}, {"arrows": "to", "from": "RM-013", "to": "RM-014"}, {"arrows": "to", "from": "RM-013", "to": "RM-015"}, {"arrows": "to", "from": "RM-013", "to": "RM-016"}, {"arrows": "to", "from": "RM-013", "to": "RM-018"}, {"arrows": "to", "from": "RM-013", "to": "RM-020"}, {"arrows": "to", "from": "RM-013", "to": "RM-024"}, {"arrows": "to", "from": "RM-013", "to": "RM-032"}, {"arrows": "to", "from": "RM-013", "to": "RM-040"}, {"arrows": "to", "from": "RM-013", "to": "RM-041"}, {"arrows": "to", "from": "RM-013", "to": "RM-050"}, {"arrows": "to", "from": "RM-014", "to": "RM-017"}, {"arrows": "to", "from": "RM-014", "to": "RM-018"}, {"arrows": "to", "from": "RM-014", "to": "RM-019"}, {"arrows": "to", "from": "RM-014", "to": "RM-027"}, {"arrows": "to", "from": "RM-014", "to": "RM-029"}, {"arrows": "to", "from": "RM-014", "to": "RM-050"}, {"arrows": "to", "from": "RM-014", "to": "RM-052"}, {"arrows": "to", "from": "RM-014", "to": "RM-053"}, {"arrows": "to", "from": "RM-015", "to": "RM-050"}, {"arrows": "to", "from": "RM-016", "to": "RM-050"}, {"arrows": "to", "from": "RM-017", "to": "RM-029"}, {"arrows": "to", "from": "RM-017", "to": "RM-030"}, {"arrows": "to", "from": "RM-017", "to": "RM-039"}, {"arrows": "to", "from": "RM-017", "to": "RM-050"}, {"arrows": "to", "from": "RM-018", "to": "RM-030"}, {"arrows": "to", "from": "RM-018", "to": "RM-050"}, {"arrows": "to", "from": "RM-019", "to": "RM-030"}, {"arrows": "to", "from": "RM-019", "to": "RM-046"}, {"arrows": "to", "from": "RM-019", "to": "RM-050"}, {"arrows": "to", "from": "RM-020", "to": "RM-016"}, {"arrows": "to", "from": "RM-020", "to": "RM-027"}, {"arrows": "to", "from": "RM-020", "to": "RM-029"}, {"arrows": "to", "from": "RM-020", "to": "RM-046"}, {"arrows": "to", "from": "RM-020", "to": "RM-050"}, {"arrows": "to", "from": "RM-021", "to": "RM-023"}, {"arrows": "to", "from": "RM-021", "to": "RM-040"}, {"arrows": "to", "from": "RM-021", "to": "RM-042"}, {"arrows": "to", "from": "RM-021", "to": "RM-050"}, {"arrows": "to", "from": "RM-021", "to": "RM-052"}, {"arrows": "to", "from": "RM-022", "to": "RM-021"}, {"arrows": "to", "from": "RM-022", "to": "RM-023"}, {"arrows": "to", "from": "RM-022", "to": "RM-040"}, {"arrows": "to", "from": "RM-022", "to": "RM-042"}, {"arrows": "to", "from": "RM-022", "to": "RM-050"}, {"arrows": "to", "from": "RM-022", "to": "RM-052"}, {"arrows": "to", "from": "RM-023", "to": "RM-024"}, {"arrows": "to", "from": "RM-023", "to": "RM-025"}, {"arrows": "to", "from": "RM-023", "to": "RM-026"}, {"arrows": "to", "from": "RM-023", "to": "RM-031"}, {"arrows": "to", "from": "RM-023", "to": "RM-036"}, {"arrows": "to", "from": "RM-023", "to": "RM-041"}, {"arrows": "to", "from": "RM-023", "to": "RM-044"}, {"arrows": "to", "from": "RM-023", "to": "RM-050"}, {"arrows": "to", "from": "RM-023", "to": "RM-052"}, {"arrows": "to", "from": "RM-024", "to": "RM-025"}, {"arrows": "to", "from": "RM-024", "to": "RM-027"}, {"arrows": "to", "from": "RM-024", "to": "RM-031"}, {"arrows": "to", "from": "RM-024", "to": "RM-050"}, {"arrows": "to", "from": "RM-024", "to": "RM-052"}, {"arrows": "to", "from": "RM-025", "to": "RM-050"}, {"arrows": "to", "from": "RM-026", "to": "RM-050"}, {"arrows": "to", "from": "RM-027", "to": "RM-028"}, {"arrows": "to", "from": "RM-027", "to": "RM-044"}, {"arrows": "to", "from": "RM-027", "to": "RM-050"}, {"arrows": "to", "from": "RM-028", "to": "RM-050"}, {"arrows": "to", "from": "RM-029", "to": "RM-039"}, {"arrows": "to", "from": "RM-029", "to": "RM-050"}, {"arrows": "to", "from": "RM-029", "to": "RM-053"}, {"arrows": "to", "from": "RM-030", "to": "RM-050"}, {"arrows": "to", "from": "RM-031", "to": "RM-050"}, {"arrows": "to", "from": "RM-032", "to": "RM-030"}, {"arrows": "to", "from": "RM-032", "to": "RM-047"}, {"arrows": "to", "from": "RM-032", "to": "RM-050"}, {"arrows": "to", "from": "RM-033", "to": "RM-029"}, {"arrows": "to", "from": "RM-033", "to": "RM-034"}, {"arrows": "to", "from": "RM-033", "to": "RM-050"}, {"arrows": "to", "from": "RM-033", "to": "RM-051"}, {"arrows": "to", "from": "RM-034", "to": "RM-028"}, {"arrows": "to", "from": "RM-034", "to": "RM-029"}, {"arrows": "to", "from": "RM-034", "to": "RM-031"}, {"arrows": "to", "from": "RM-034", "to": "RM-032"}, {"arrows": "to", "from": "RM-034", "to": "RM-045"}, {"arrows": "to", "from": "RM-034", "to": "RM-050"}, {"arrows": "to", "from": "RM-034", "to": "RM-051"}, {"arrows": "to", "from": "RM-035", "to": "RM-043"}, {"arrows": "to", "from": "RM-035", "to": "RM-050"}, {"arrows": "to", "from": "RM-036", "to": "RM-037"}, {"arrows": "to", "from": "RM-036", "to": "RM-046"}, {"arrows": "to", "from": "RM-036", "to": "RM-047"}, {"arrows": "to", "from": "RM-036", "to": "RM-050"}, {"arrows": "to", "from": "RM-037", "to": "RM-050"}, {"arrows": "to", "from": "RM-038", "to": "RM-050"}, {"arrows": "to", "from": "RM-039", "to": "RM-050"}, {"arrows": "to", "from": "RM-040", "to": "RM-050"}, {"arrows": "to", "from": "RM-041", "to": "RM-043"}, {"arrows": "to", "from": "RM-041", "to": "RM-049"}, {"arrows": "to", "from": "RM-041", "to": "RM-050"}, {"arrows": "to", "from": "RM-042", "to": "RM-050"}, {"arrows": "to", "from": "RM-043", "to": "RM-035"}, {"arrows": "to", "from": "RM-043", "to": "RM-048"}, {"arrows": "to", "from": "RM-043", "to": "RM-050"}, {"arrows": "to", "from": "RM-044", "to": "RM-050"}, {"arrows": "to", "from": "RM-045", "to": "RM-050"}, {"arrows": "to", "from": "RM-046", "to": "RM-050"}, {"arrows": "to", "from": "RM-047", "to": "RM-050"}, {"arrows": "to", "from": "RM-048", "to": "RM-050"}, {"arrows": "to", "from": "RM-049", "to": "RM-050"}, {"arrows": "to", "from": "RM-051", "to": "RM-052"}, {"arrows": "to", "from": "RM-051", "to": "RM-053"}, {"arrows": "to", "from": "RM-052", "to": "RM-053"}]);

                  nodeColors = {};
                  allNodes = nodes.get({ returnType: "Object" });
                  for (nodeId in allNodes) {
                    nodeColors[nodeId] = allNodes[nodeId].color;
                  }
                  allEdges = edges.get({ returnType: "Object" });
                  // adding nodes and edges to the graph
                  data = {nodes: nodes, edges: edges};

                  var options = {"nodes": {"font": {"size": 14, "face": "arial", "strokeWidth": 3, "strokeColor": "#1a1a2e"}, "borderWidth": 2, "borderWidthSelected": 4, "shadow": {"enabled": true, "color": "rgba(0,0,0,0.5)", "size": 10, "x": 3, "y": 3}}, "edges": {"color": {"color": "#4a4a6a", "highlight": "#00ff88", "hover": "#00ff88"}, "arrows": {"to": {"enabled": true, "scaleFactor": 0.8}}, "smooth": {"enabled": true, "type": "curvedCW", "roundness": 0.2}, "width": 1.5, "selectionWidth": 3}, "physics": {"enabled": true, "solver": "forceAtlas2Based", "forceAtlas2Based": {"gravitationalConstant": -80, "centralGravity": 0.01, "springLength": 150, "springConstant": 0.08, "damping": 0.4, "avoidOverlap": 0.8}, "stabilization": {"enabled": true, "iterations": 200, "updateInterval": 25}}, "interaction": {"hover": true, "hoverConnectedEdges": true, "selectConnectedEdges": true, "multiselect": true, "dragNodes": true, "dragView": true, "zoomView": true, "navigationButtons": true, "keyboard": {"enabled": true, "speed": {"x": 10, "y": 10, "zoom": 0.1}}, "tooltipDelay": 100}, "configure": {"enabled": false}};

                  


                  

                  network = new vis.Network(container, data, options);

                  

                  

                  


                  

                  return network;

              }
              drawGraph();
        </script>
    
    <script>
    (function() {
        // Data
        const nodeData = {"RM-001": {"area": "Ingesta", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Registro de traders y fuentes de desempe√±o", "requisito": "El sistema deber√° permitir cargar y administrar una lista configurable de N traders con metadatos (trader_id, nombre/alias, regi√≥n/pa√≠s, etiquetas/estrategia, estatus) y 1..N fuentes de desempe√±o por trader. Fuentes soportadas: (a) MyFXBook (URL/perfil o identificador), (b) cuentas MetaTrader 4/5 en...", "owner": "Backend", "roles": "Admin; Analista (Gema); Sistema", "estatus": "BACKLOG", "dependencias": "‚Äî", "in_degree": 0, "out_degree": 7, "in_cycle": false}, "RM-002": {"area": "Ingesta", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Validaci√≥n de fuentes y credenciales (URL + MT4/MT5)", "requisito": "Antes de ejecutar extracci√≥n/sync, el sistema deber√° validar cada fuente: URLs (sintaxis, esquema, dominio, alcanzabilidad) y cuentas MT4/MT5 (handshake/credenciales de inversionista, latencia, ventana hist√≥rica disponible). Debe persistir el resultado con c√≥digo de error, detalle legible y pol√≠tica...", "owner": "Backend", "roles": "Sistema; Admin; Analista (Gema)", "estatus": "BACKLOG", "dependencias": "RM-001", "in_degree": 1, "out_degree": 4, "in_cycle": false}, "RM-003": {"area": "Ingesta", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Pol√≠ticas de acceso por dominio (robots/ToS)", "requisito": "El sistema deber√° registrar pol√≠ticas por dominio (robots.txt snapshot, rate limit, notas ToS internas) y hacer cumplir dichas pol√≠ticas durante la extracci√≥n. Debe permitir bloquear dominios o pausar scraping.", "owner": "Backend/DevOps", "roles": "Admin; DevOps; Sistema", "estatus": "BACKLOG", "dependencias": "RM-001,RM-002", "in_degree": 2, "out_degree": 3, "in_cycle": false}, "RM-004": {"area": "Ingesta", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Scheduler de syncs", "requisito": "El sistema deber√° soportar ejecuci√≥n programada (frecuencia configurable por fuente) y refresh on-demand por trader/fuente, generando jobs con trazabilidad (run_id, trader_id, source_id, created_by). Debe soportar ventanas de sync diarias/semanales (configurable) y priorizar sincronizaci√≥n increment...", "owner": "Backend/DevOps", "roles": "Admin; Analista; Sistema", "estatus": "BACKLOG", "dependencias": "RM-001", "in_degree": 1, "out_degree": 8, "in_cycle": false}, "RM-005": {"area": "Ingesta", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Rate limiting, retries y circuit breaker", "requisito": "El sistema deber√° implementar rate limiting por dominio, retries con exponential backoff y circuit breaker ante fallas repetidas. Debe registrar m√©tricas de requests y errores.", "owner": "Backend/DevOps", "roles": "Sistema; DevOps", "estatus": "BACKLOG", "dependencias": "RM-003", "in_degree": 1, "out_degree": 4, "in_cycle": false}, "RM-006": {"area": "Extracci√≥n", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Adaptadores por fuente (MyFXBook / ForexFactory / HTML) y extracci√≥n mantenible", "requisito": "El sistema deber√° extraer datos crudos usando adaptadores por fuente: MyFXBook (HTML/API), ForexFactory (si se usa), y otros sitios HTML, con selectores/mapeos mantenibles y testeables, versionando el parser/adapter. Para MT4/MT5, la extracci√≥n se realizar√° v√≠a conector dedicado a partir de credenci...", "owner": "Backend", "roles": "Sistema; Backend", "estatus": "BACKLOG", "dependencias": "RM-004,RM-005", "in_degree": 2, "out_degree": 7, "in_cycle": false}, "RM-007": {"area": "Extracci√≥n", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Soporte JSON/API cuando exista", "requisito": "Cuando exista una API oficial o feed estructurado, el sistema deber√° preferirlo sobre scraping. Debe soportar: API de MyFXBook (si aplica), exportaciones/feeds de brokers cuando existan, y endpoints estructurados de proveedores. Debe registrar limits, versionado y fallbacks.", "owner": "Backend", "roles": "Sistema; Backend", "estatus": "BACKLOG", "dependencias": "RM-006", "in_degree": 1, "out_degree": 1, "in_cycle": false}, "RM-008": {"area": "Extracci√≥n", "prioridad": "Baja (P2)", "version": "v0.3", "funcionalidad": "Soporte de reportes de broker (PDF/XLS) y adjuntos", "requisito": "El sistema deber√° permitir incorporar reportes de broker asociados a un trader/fuente: (a) detectar y descargar adjuntos/links (PDF u otros permitidos) cuando est√©n presentes y permitidos por pol√≠tica, y (b) permitir carga manual de reportes (PDF/XLS) cuando el trader no tenga MyFXBook. Debe guardar...", "owner": "Backend", "roles": "Sistema; Backend", "estatus": "BACKLOG", "dependencias": "RM-003,RM-006", "in_degree": 2, "out_degree": 1, "in_cycle": false}, "RM-009": {"area": "Modelo de datos", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Almacenamiento de datos crudos versionados", "requisito": "El sistema deber√° guardar registros crudos inmutables con fuente (source_id), timestamp, adapter_version, content_hash y payload (JSON/bytes). No debe sobrescribir datos crudos. Debe soportar snapshots diarios para retener hist√≥rico multianual (p.ej. MyFXBook), y registrar expl√≠citamente la ventana ...", "owner": "Backend", "roles": "Sistema; Backend", "estatus": "BACKLOG", "dependencias": "RM-006", "in_degree": 1, "out_degree": 8, "in_cycle": false}, "RM-010": {"area": "Modelo de datos", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Entidades normalizadas y snapshots", "requisito": "El sistema deber√° normalizar datos crudos a entidades n√∫cleo (Trader, PerformanceSource, DailySummary, Trade/Deal, MetricDefinition, MetricValue, Run, Experiment) y soportar snapshots temporalmente indexados por trader y por fuente. Debe soportar m√∫ltiples fuentes por trader y reconciliaci√≥n por per...", "owner": "Backend", "roles": "Backend; Quant; Sistema", "estatus": "BACKLOG", "dependencias": "RM-009", "in_degree": 1, "out_degree": 7, "in_cycle": false}, "RM-011": {"area": "Transformaci√≥n", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Reglas de mapeo configurables", "requisito": "El sistema deber√° permitir definir reglas de mapeo (por dominio) desde campos crudos a campos normalizados, con versionado y capacidad de rollback. Idealmente sin despliegue de c√≥digo para cambios menores.", "owner": "Backend", "roles": "Admin; Backend; Quant", "estatus": "BACKLOG", "dependencias": "RM-010", "in_degree": 1, "out_degree": 5, "in_cycle": false}, "RM-012": {"area": "Transformaci√≥n", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Limpieza y estandarizaci√≥n de datos", "requisito": "El sistema deber√° limpiar y estandarizar formatos (fechas, divisas, porcentajes, locales) a formatos can√≥nicos y registrar errores de parseo por campo.", "owner": "Backend", "roles": "Backend; Sistema", "estatus": "BACKLOG", "dependencias": "RM-011", "in_degree": 1, "out_degree": 1, "in_cycle": false}, "RM-013": {"area": "M√©tricas", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Cat√°logo de definiciones de m√©tricas", "requisito": "El sistema deber√° mantener un registro versionado de m√©tricas (nombre, f√≥rmula/algoritmo, insumos requeridos, unidad, rango v√°lido, y constraints). Ser√° la fuente √∫nica para c√≥mputo y reporteo.", "owner": "Backend/Quant", "roles": "Quant; Backend; Admin", "estatus": "BACKLOG", "dependencias": "RM-010", "in_degree": 1, "out_degree": 10, "in_cycle": false}, "RM-014": {"area": "M√©tricas", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "C√°lculo de m√©tricas core", "requisito": "El sistema deber√° calcular m√©tricas base por trader, por fuente y por periodo (p.ej. rendimiento, volatilidad, drawdown, win-rate) a partir de los datos disponibles, y manejar expl√≠citamente el caso de ‚Äúdatos insuficientes‚Äù. Debe distinguir cobertura temporal (multi-a√±o vs 6‚Äì12 meses) y reflejarlo e...", "owner": "Quant", "roles": "Quant; Sistema", "estatus": "BACKLOG", "dependencias": "RM-013", "in_degree": 1, "out_degree": 8, "in_cycle": false}, "RM-015": {"area": "M√©tricas", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "M√©tricas de costos/fees", "requisito": "El sistema deber√° calcular m√©tricas relacionadas a costos/fees/spread cuando existan, documentando supuestos y anex√°ndolos a reportes y exportaciones.", "owner": "Quant", "roles": "Quant; Analista", "estatus": "BACKLOG", "dependencias": "RM-013", "in_degree": 1, "out_degree": 1, "in_cycle": false}, "RM-016": {"area": "M√©tricas", "prioridad": "Baja (P2)", "version": "v0.3", "funcionalidad": "Flags de riesgo/compliance basados en reglas", "requisito": "El sistema deber√° evaluar reglas determin√≠sticas para generar banderas (p.ej. disclosures faltantes, claims an√≥malos) y adjuntar evidencia (campo crudo + snapshot) para cada flag.", "owner": "Quant/Backend", "roles": "Quant; Analista; Admin", "estatus": "BACKLOG", "dependencias": "RM-013,RM-020", "in_degree": 2, "out_degree": 1, "in_cycle": false}, "RM-017": {"area": "M√©tricas", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Benchmarks, percentiles y rankings", "requisito": "El sistema deber√° calcular benchmarks, percentiles y rankings comparables entre traders (por ventana temporal) e incluir filtros por estrategia/etiquetas. Debe poder generar rankings separados por tipo de fuente y un ranking consolidado (si hay reglas de consolidaci√≥n).", "owner": "Quant", "roles": "Analista; Viewer", "estatus": "BACKLOG", "dependencias": "RM-014", "in_degree": 1, "out_degree": 4, "in_cycle": false}, "RM-018": {"area": "Calidad de datos", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Score de completitud", "requisito": "El sistema deber√° calcular un score de completitud por trader, por fuente y por m√©trica en [0,1], basado en disponibilidad de insumos y cobertura temporal. Debe mostrarse en dashboard y reportes.", "owner": "Backend/Quant", "roles": "Analista; Viewer", "estatus": "BACKLOG", "dependencias": "RM-013,RM-014", "in_degree": 2, "out_degree": 2, "in_cycle": false}, "RM-019": {"area": "Calidad de datos", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Detecci√≥n de anomal√≠as", "requisito": "El sistema deber√° detectar anomal√≠as (saltos bruscos de m√©tricas, huecos temporales, cambios de parser/mapping) y etiquetar resultados afectados; debe permitir filtrar anomal√≠as en validaci√≥n del algoritmo.", "owner": "Quant/Backend", "roles": "Analista; Quant; DevOps", "estatus": "BACKLOG", "dependencias": "RM-014,RM-011,RM-009", "in_degree": 3, "out_degree": 3, "in_cycle": false}, "RM-020": {"area": "Auditabilidad", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Lineage de m√©tricas a raw data", "requisito": "El sistema deber√° proveer trazabilidad desde cualquier valor de m√©trica/ranking/reporte hasta los raw_records y transformaciones usadas (parser_version, mapping_version, metric_definition_version).", "owner": "Backend", "roles": "Analista; Admin", "estatus": "BACKLOG", "dependencias": "RM-009,RM-013", "in_degree": 2, "out_degree": 5, "in_cycle": false}, "RM-021": {"area": "Validaci√≥n de algoritmo", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Contrato de integraci√≥n del algoritmo", "requisito": "El sistema deber√° integrar el algoritmo de optimizaci√≥n del cliente mediante una interfaz definida (CLI/API/librer√≠a) con versionado (algorithm_build_id) y entradas/salidas determin√≠sticas o con tolerancia definida. El objetivo primario es proponer distribuci√≥n de capital (weights/allocations) entre...", "owner": "Backend/Quant", "roles": "Quant; Backend; DevOps", "estatus": "BACKLOG", "dependencias": "RM-022", "in_degree": 1, "out_degree": 5, "in_cycle": false}, "RM-022": {"area": "Validaci√≥n de algoritmo", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Constructor de datasets (feature matrix)", "requisito": "El sistema deber√° construir datasets de validaci√≥n desde datos normalizados (features de desempe√±o/riesgo por trader, y/o targets si aplica) con ventanas temporales expl√≠citas y metadatos (schema_version, trader_set, feature_list, coverage). Debe poder generar datasets por tipo de cliente (retail/in...", "owner": "Quant/Backend", "roles": "Quant; Analista", "estatus": "BACKLOG", "dependencias": "RM-010", "in_degree": 1, "out_degree": 6, "in_cycle": false}, "RM-023": {"area": "Validaci√≥n de algoritmo", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Runner de backtests/experimentos", "requisito": "El sistema deber√° ejecutar runs de validaci√≥n sobre datasets seleccionados, guardando par√°metros, logs, outputs, y m√©tricas de ejecuci√≥n. Debe soportar tipos de run (train/validate/test) si aplica y escenarios de ‚Äúallocation simulation‚Äù (recomendar pesos y evaluar desempe√±o te√≥rico vs real cuando ex...", "owner": "Quant/Backend", "roles": "Quant; Analista", "estatus": "BACKLOG", "dependencias": "RM-021,RM-022", "in_degree": 2, "out_degree": 9, "in_cycle": false}, "RM-024": {"area": "Validaci√≥n de algoritmo", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "M√©tricas de evaluaci√≥n y scorecards", "requisito": "El sistema deber√° calcular m√©tricas de evaluaci√≥n y scorecards del algoritmo (p.ej. retorno vs riesgo, drawdown esperado, estabilidad, concentraci√≥n, turnover) y comparar contra baselines (equal-weight, top-N por Sharpe, etc.). Debe soportar segmentaci√≥n por tama√±o de paquete de capital.", "owner": "Quant", "roles": "Quant; Analista; Viewer", "estatus": "BACKLOG", "dependencias": "RM-023,RM-013", "in_degree": 2, "out_degree": 5, "in_cycle": false}, "RM-025": {"area": "Validaci√≥n de algoritmo", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Diagn√≥sticos y sensibilidad", "requisito": "El sistema deber√° generar diagn√≥sticos para runs (p.ej. an√°lisis de fallos, frecuencia de constraints activas, ablation/feature importance si aplica) y exportarlos en reporte t√©cnico.", "owner": "Quant", "roles": "Quant; Analista", "estatus": "BACKLOG", "dependencias": "RM-023,RM-024", "in_degree": 2, "out_degree": 1, "in_cycle": false}, "RM-026": {"area": "Validaci√≥n de algoritmo", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "What-if y parameter sweeps", "requisito": "El sistema deber√° permitir ejecutar batch de escenarios (fees ¬±x, imputaci√≥n, distintos thresholds) y comparar resultados en una tabla/visualizaci√≥n √∫nica.", "owner": "Quant/Backend", "roles": "Quant; Analista", "estatus": "BACKLOG", "dependencias": "RM-023", "in_degree": 1, "out_degree": 1, "in_cycle": false}, "RM-027": {"area": "Reportes", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Plantillas y generaci√≥n de reportes", "requisito": "El sistema deber√° generar reportes versionados (PDF/HTML) para uso interno con: resumen de traders (rankings), recomendaci√≥n de distribuci√≥n de capital por paquete, tesis/objetivo, evidencia (fuentes y coverage), y anexos (raw/lineage). Debe permitir templates configurables por tipo de cliente (reta...", "owner": "Backend", "roles": "Analista; Viewer; Admin", "estatus": "BACKLOG", "dependencias": "RM-014,RM-024,RM-020", "in_degree": 3, "out_degree": 3, "in_cycle": false}, "RM-028": {"area": "Reportes", "prioridad": "Baja (P2)", "version": "v0.3", "funcionalidad": "Distribuci√≥n programada", "requisito": "El sistema deber√° soportar generaci√≥n y distribuci√≥n programada de reportes (link seguro, email y/o webhook), con reintentos y alertas de falla.", "owner": "Backend/DevOps", "roles": "Admin; DevOps; Sistema", "estatus": "BACKLOG", "dependencias": "RM-027,RM-004,RM-034", "in_degree": 3, "out_degree": 1, "in_cycle": false}, "RM-029": {"area": "Dashboard", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Vistas core del dashboard", "requisito": "El sistema deber√° proveer dashboard con: lista de traders + filtros (estrategia, fuente, coverage), p√°gina detalle trader con charts, y resumen de validaci√≥n del algoritmo; debe soportar drill-down a lineage y ver estado de fuentes (MyFXBook/MT4/MT5/reportes).", "owner": "Frontend", "roles": "Viewer; Analista; Admin", "estatus": "BACKLOG", "dependencias": "RM-014,RM-017,RM-020,RM-033,RM-034", "in_degree": 5, "out_degree": 3, "in_cycle": false}, "RM-030": {"area": "Dashboard", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Comparaciones y rankings", "requisito": "El sistema deber√° permitir comparaci√≥n side-by-side de traders y tablas de ranking con columnas configurables, ordenamiento y exportaci√≥n. Debe incluir comparaciones por ventana temporal (6m/12m/24m/total disponible) para evitar sesgos por coverage.", "owner": "Frontend", "roles": "Viewer; Analista", "estatus": "BACKLOG", "dependencias": "RM-017,RM-032,RM-018,RM-019", "in_degree": 4, "out_degree": 1, "in_cycle": false}, "RM-031": {"area": "Dashboard", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Explorador de runs/experimentos", "requisito": "El sistema deber√° proveer UI para explorar runs (filtros por versi√≥n, par√°metros, fecha, estado) y comparar 2+ runs, mostrando diffs y scorecards.", "owner": "Frontend", "roles": "Analista; Quant", "estatus": "BACKLOG", "dependencias": "RM-023,RM-024,RM-034", "in_degree": 3, "out_degree": 1, "in_cycle": false}, "RM-032": {"area": "Exportaci√≥n", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Exports de datos y resultados", "requisito": "El sistema deber√° exportar (CSV/JSON) registro de traders+fuentes, m√©tricas y resultados de runs con metadatos de schema y unidades; exports grandes deben ser as√≠ncronos.", "owner": "Backend", "roles": "Analista; Admin", "estatus": "BACKLOG", "dependencias": "RM-010,RM-013,RM-034", "in_degree": 3, "out_degree": 3, "in_cycle": false}, "RM-033": {"area": "Seguridad", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Autenticaci√≥n", "requisito": "El sistema deber√° requerir autenticaci√≥n para dashboard, reportes y exports (email/password o SSO/OIDC), con sesiones seguras, CSRF donde aplique y pol√≠ticas de password.", "owner": "Backend/DevOps", "roles": "Admin; Viewer; Analista", "estatus": "BACKLOG", "dependencias": "‚Äî", "in_degree": 0, "out_degree": 4, "in_cycle": false}, "RM-034": {"area": "Seguridad", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Autorizaci√≥n y roles (RBAC)", "requisito": "El sistema deber√° implementar RBAC (Admin, Analista, Viewer) controlando: alta/edici√≥n de traders/fuentes, ejecuci√≥n de runs, exports, cambios de pol√≠ticas, acceso a auditor√≠as, y (si aplica) gesti√≥n de paquetes de capital/tesis.", "owner": "Backend/Frontend", "roles": "Admin; Analista; Viewer", "estatus": "BACKLOG", "dependencias": "RM-033", "in_degree": 1, "out_degree": 7, "in_cycle": false}, "RM-035": {"area": "Seguridad", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Gesti√≥n de secretos", "requisito": "El sistema deber√° gestionar secretos (API keys, SMTP, webhooks) fuera del repositorio (env/secret manager) y activar detecci√≥n de secretos en CI.", "owner": "DevOps", "roles": "DevOps", "estatus": "BACKLOG", "dependencias": "RM-043", "in_degree": 1, "out_degree": 2, "in_cycle": true}, "RM-036": {"area": "Observabilidad", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Logging estructurado con correlaci√≥n", "requisito": "El sistema deber√° emitir logs estructurados (JSON) para ingesta, transformaci√≥n, m√©tricas y runs con correlation_id (run_id, trader_id, source_id, job_id) y niveles consistentes.", "owner": "DevOps", "roles": "DevOps; Backend", "estatus": "BACKLOG", "dependencias": "RM-004,RM-023", "in_degree": 2, "out_degree": 4, "in_cycle": false}, "RM-037": {"area": "Observabilidad", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "M√©tricas y alertas operativas", "requisito": "El sistema deber√° exponer m√©tricas (duraci√≥n de jobs, tasa de √©xito, errores de scraping, latencia API) y alertas por umbrales (p.ej. fallas >X%, retrasos).", "owner": "DevOps", "roles": "DevOps; Admin", "estatus": "BACKLOG", "dependencias": "RM-036", "in_degree": 1, "out_degree": 1, "in_cycle": false}, "RM-038": {"area": "Performance", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Throughput del pipeline", "requisito": "El sistema deber√° procesar N traders y sus fuentes dentro de SLAs razonables. Aunque la frecuencia de uso puede ser baja (decisiones por paquetes de capital), la ejecuci√≥n de sync y c√°lculo debe ser confiable, idempotente y trazable. Debe soportar incremental updates para no re-procesar hist√≥rico co...", "owner": "Backend/DevOps", "roles": "DevOps; Backend", "estatus": "BACKLOG", "dependencias": "RM-005,RM-004", "in_degree": 2, "out_degree": 1, "in_cycle": false}, "RM-039": {"area": "Performance", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Responsividad del dashboard", "requisito": "El sistema deber√° mantener interacciones del dashboard con P95 <2s para consultas t√≠picas y <10s para consultas pesadas, mostrando indicador de progreso si aplica.", "owner": "Backend/Frontend", "roles": "Frontend; Backend", "estatus": "BACKLOG", "dependencias": "RM-029,RM-017", "in_degree": 2, "out_degree": 1, "in_cycle": false}, "RM-040": {"area": "Reproducibilidad", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Versionado end-to-end de componentes", "requisito": "El sistema deber√° versionar y relacionar parsers, mapeos, definiciones de m√©tricas, datasets y builds del algoritmo, y asociarlos a cada run y reporte.", "owner": "Backend/Quant", "roles": "Quant; Backend", "estatus": "BACKLOG", "dependencias": "RM-009,RM-011,RM-013,RM-021,RM-022", "in_degree": 5, "out_degree": 1, "in_cycle": false}, "RM-041": {"area": "Testing", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Suite de unit/integration/E2E", "requisito": "El sistema deber√° incluir pruebas autom√°ticas para parsers, transformaciones, m√©tricas y runner del algoritmo. Debe usar fixtures grabadas (no depender de sitios live) y seguir enfoque RED/GREEN.", "owner": "All", "roles": "Backend; Quant; Frontend", "estatus": "BACKLOG", "dependencias": "RM-006,RM-013,RM-023", "in_degree": 3, "out_degree": 3, "in_cycle": false}, "RM-042": {"area": "Testing", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Data contract tests (schemas)", "requisito": "El sistema deber√° aplicar data contracts entre extracci√≥n‚Üínormalizaci√≥n‚Üídataset‚Üíalgoritmo (schemas versionados) y fallar CI ante cambios rompientes.", "owner": "Backend", "roles": "Backend; Quant", "estatus": "BACKLOG", "dependencias": "RM-010,RM-022,RM-021", "in_degree": 3, "out_degree": 1, "in_cycle": false}, "RM-043": {"area": "DevOps", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "CI/CD + migraciones + rollback", "requisito": "El sistema deber√° contar con CI/CD para build, tests, deploy y migraciones DB, con promoci√≥n de ambientes (dev/stage/prod) y procedimiento de rollback probado.", "owner": "DevOps", "roles": "DevOps", "estatus": "BACKLOG", "dependencias": "RM-041,RM-035", "in_degree": 2, "out_degree": 3, "in_cycle": true}, "RM-044": {"area": "Gobernanza de datos", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Retenci√≥n y archivado", "requisito": "El sistema deber√° definir pol√≠ticas de retenci√≥n para raw_records, snapshots, outputs de runs, logs y reportes (purga/archivado) sin dejar referencias hu√©rfanas.", "owner": "Backend/DevOps", "roles": "Admin; DevOps", "estatus": "BACKLOG", "dependencias": "RM-009,RM-023,RM-027", "in_degree": 3, "out_degree": 1, "in_cycle": false}, "RM-045": {"area": "Gobernanza", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Bit√°cora de auditor√≠a de acciones cr√≠ticas", "requisito": "El sistema deber√° registrar eventos de auditor√≠a para: cambios de traders/fuentes (URLs/credenciales), ejecuciones de runs, exports, cambios de roles, cambios de pol√≠ticas, cambios/ejecuciones de tesis/asignaci√≥n (si aplica), y accesos a reportes/lineage.", "owner": "Backend", "roles": "Admin", "estatus": "BACKLOG", "dependencias": "RM-034", "in_degree": 1, "out_degree": 1, "in_cycle": false}, "RM-046": {"area": "UX", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Transparencia de errores y remediaci√≥n", "requisito": "El sistema deber√° mostrar errores claros y accionables (parser roto, dominio bloqueado, datos insuficientes, run fallido), con pasos sugeridos y links a evidencia (logs/lineage).", "owner": "Frontend", "roles": "Viewer; Analista; Admin", "estatus": "BACKLOG", "dependencias": "RM-019,RM-036,RM-020", "in_degree": 3, "out_degree": 1, "in_cycle": false}, "RM-047": {"area": "Privacidad", "prioridad": "Baja (P2)", "version": "v0.3", "funcionalidad": "Minimizaci√≥n y redacci√≥n de datos", "requisito": "El sistema deber√° almacenar s√≥lo campos necesarios y permitir redacci√≥n/omisi√≥n de campos sensibles (si aparecen) en salidas (dash/report/export) seg√∫n pol√≠tica.", "owner": "Backend/DevOps", "roles": "Admin; DevOps", "estatus": "BACKLOG", "dependencias": "RM-036,RM-032", "in_degree": 2, "out_degree": 1, "in_cycle": false}, "RM-048": {"area": "Documentaci√≥n", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Docs t√©cnicas y operativas", "requisito": "El sistema deber√° incluir documentaci√≥n: setup local, despliegue, runbooks, cat√°logo de m√©tricas, c√≥mo agregar un nuevo dominio/adaptador y c√≥mo ejecutar validaci√≥n del algoritmo.", "owner": "All", "roles": "All", "estatus": "BACKLOG", "dependencias": "RM-043", "in_degree": 1, "out_degree": 1, "in_cycle": false}, "RM-049": {"area": "Extensibilidad", "prioridad": "Media (P1)", "version": "v0.2", "funcionalidad": "Onboarding de nuevo dominio/fuente", "requisito": "El sistema deber√° ofrecer un proceso est√°ndar (template de adapter + mapping + fixtures + tests) para agregar un nuevo dominio en <=1 d√≠a para un sitio t√≠pico.", "owner": "Backend", "roles": "Backend; Quant", "estatus": "BACKLOG", "dependencias": "RM-006,RM-011,RM-041", "in_degree": 3, "out_degree": 1, "in_cycle": false}, "RM-050": {"area": "Entregables", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Criterio de aceptaci√≥n del MVP", "requisito": "El MVP deber√° incluir: registro de traders+fuentes (MyFXBook/MT4/MT5/reportes), scheduler, extracci√≥n+normalizaci√≥n, m√©tricas core, dashboard b√°sico, construcci√≥n de dataset, ejecuci√≥n de runs, scorecard, y generaci√≥n de reportes con versionado/lineage. Debe incluir al menos un flujo de ‚Äúpaquete de ...", "owner": "PM/All", "roles": "PM; Admin; Analista", "estatus": "BACKLOG", "dependencias": "RM-001..RM-049", "in_degree": 49, "out_degree": 0, "in_cycle": false}, "RM-051": {"area": "Gesti√≥n de capital", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Registro de clientes y paquetes de capital", "requisito": "El sistema deber√° permitir registrar clientes/fuentes de capital (retail e institucional/family office), con pa√≠s/regi√≥n (p.ej. M√©xico/Colombia), moneda, monto, perfil de riesgo y restricciones (m√≠nimos/m√°ximos, concentraci√≥n, instrumentos prohibidos si aplica). Debe permitir registrar paquetes de c...", "owner": "Backend", "roles": "Admin; Analista (Gema); PM", "estatus": "BACKLOG", "dependencias": "RM-033,RM-034,RM-001", "in_degree": 3, "out_degree": 2, "in_cycle": false}, "RM-052": {"area": "Gesti√≥n de riesgos", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Modelo/ecuaci√≥n de distribuci√≥n de capital", "requisito": "El sistema deber√° permitir a la analista definir y versionar la ‚Äútesis‚Äù/modelo de asignaci√≥n por paquete de capital: objetivo (retorno/riesgo), par√°metros/ponderaciones (p.ej. 0.2, 0.5, 0.5, 0.55), restricciones (concentraci√≥n, l√≠mites por trader), y ventana hist√≥rica a usar. Debe ejecutar el algori...", "owner": "Backend/Quant/Frontend", "roles": "Analista (Gema); Admin; Quant", "estatus": "BACKLOG", "dependencias": "RM-051,RM-014,RM-021,RM-022,RM-023,RM-024", "in_degree": 6, "out_degree": 1, "in_cycle": false}, "RM-053": {"area": "Seguimiento", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Seguimiento post-inversi√≥n de tesis de inversi√≥n", "requisito": "Una vez que un paquete de capital se marca como ‚Äúinvertido‚Äù, el sistema deber√° dar seguimiento a la tesis: comparar desempe√±o real vs esperado (por trader y agregado), calcular desviaciones, y generar checkpoints (diario o semanal configurable). Debe permitir registrar decisiones de continuidad (man...", "owner": "Backend/Frontend", "roles": "Analista (Gema); Admin", "estatus": "BACKLOG", "dependencias": "RM-051,RM-052,RM-004,RM-014,RM-029", "in_degree": 5, "out_degree": 0, "in_cycle": false}, "RM-054": {"area": "Integraciones", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Conector MyFXBook (sync de summaries)", "requisito": "El sistema deber√° implementar un conector para MyFXBook que permita obtener historial y res√∫menes (preferentemente diarios) por cuenta/perfil, soportando retenci√≥n multianual al persistir snapshots. Debe manejar autenticaci√≥n/token si aplica, rate limits, y fallbacks (HTML parsing) con trazabilidad.", "owner": "Backend", "roles": "Backend; DevOps", "estatus": "BACKLOG", "dependencias": "RM-001,RM-002,RM-004,RM-005,RM-006,RM-009", "in_degree": 6, "out_degree": 0, "in_cycle": false}, "RM-055": {"area": "Integraciones", "prioridad": "Alta (P0)", "version": "MVP v0.1", "funcionalidad": "Conector MetaTrader 4/5 (modo inversionista)", "requisito": "El sistema deber√° implementar un conector para MetaTrader 4/5 en modo monitoreo (credenciales de inversionista) para obtener operaciones y equity/statement en la ventana hist√≥rica disponible por broker (t√≠picamente 6‚Äì12 meses). Debe soportar m√∫ltiples brokers/servidores, cuentas demo para pruebas, y...", "owner": "Backend/DevOps", "roles": "Backend; DevOps", "estatus": "BACKLOG", "dependencias": "RM-001,RM-002,RM-004,RM-009,RM-010", "in_degree": 5, "out_degree": 0, "in_cycle": false}};
        const subgraphData = {"RM-001": {"ancestors": [], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-007", "RM-050", "RM-017", "RM-031", "RM-038", "RM-004", "RM-035", "RM-055", "RM-053", "RM-005", "RM-025", "RM-015", "RM-052", "RM-020", "RM-003", "RM-021", "RM-026", "RM-049", "RM-044", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-032", "RM-014", "RM-028", "RM-040", "RM-042", "RM-002", "RM-054", "RM-051", "RM-046", "RM-006", "RM-009", "RM-008", "RM-048", "RM-039"]}, "RM-002": {"ancestors": ["RM-001"], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-007", "RM-050", "RM-017", "RM-031", "RM-038", "RM-035", "RM-055", "RM-053", "RM-005", "RM-025", "RM-015", "RM-052", "RM-020", "RM-003", "RM-021", "RM-026", "RM-049", "RM-044", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-032", "RM-014", "RM-028", "RM-040", "RM-042", "RM-054", "RM-046", "RM-006", "RM-009", "RM-008", "RM-048", "RM-039"]}, "RM-003": {"ancestors": ["RM-002", "RM-001"], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-007", "RM-050", "RM-017", "RM-031", "RM-038", "RM-035", "RM-055", "RM-053", "RM-005", "RM-025", "RM-015", "RM-052", "RM-020", "RM-021", "RM-026", "RM-049", "RM-044", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-032", "RM-014", "RM-028", "RM-040", "RM-042", "RM-054", "RM-046", "RM-006", "RM-009", "RM-008", "RM-048", "RM-039"]}, "RM-004": {"ancestors": ["RM-001"], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-007", "RM-050", "RM-017", "RM-031", "RM-038", "RM-035", "RM-055", "RM-053", "RM-025", "RM-015", "RM-052", "RM-020", "RM-021", "RM-026", "RM-049", "RM-044", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-032", "RM-014", "RM-028", "RM-040", "RM-042", "RM-054", "RM-046", "RM-006", "RM-009", "RM-008", "RM-048", "RM-039"]}, "RM-005": {"ancestors": ["RM-002", "RM-001", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-007", "RM-050", "RM-017", "RM-031", "RM-038", "RM-035", "RM-055", "RM-053", "RM-025", "RM-015", "RM-052", "RM-020", "RM-021", "RM-026", "RM-049", "RM-044", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-032", "RM-014", "RM-028", "RM-040", "RM-042", "RM-054", "RM-046", "RM-006", "RM-009", "RM-008", "RM-048", "RM-039"]}, "RM-006": {"ancestors": ["RM-002", "RM-005", "RM-001", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-007", "RM-050", "RM-017", "RM-031", "RM-035", "RM-055", "RM-053", "RM-025", "RM-015", "RM-052", "RM-020", "RM-021", "RM-026", "RM-049", "RM-044", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-032", "RM-014", "RM-028", "RM-040", "RM-042", "RM-054", "RM-046", "RM-009", "RM-008", "RM-048", "RM-039"]}, "RM-007": {"ancestors": ["RM-002", "RM-005", "RM-006", "RM-001", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-008": {"ancestors": ["RM-002", "RM-006", "RM-005", "RM-001", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-009": {"ancestors": ["RM-002", "RM-005", "RM-006", "RM-001", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-050", "RM-017", "RM-031", "RM-035", "RM-055", "RM-053", "RM-025", "RM-015", "RM-052", "RM-020", "RM-021", "RM-026", "RM-044", "RM-049", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-032", "RM-014", "RM-028", "RM-040", "RM-042", "RM-054", "RM-046", "RM-048", "RM-039"]}, "RM-010": {"ancestors": ["RM-002", "RM-005", "RM-006", "RM-009", "RM-001", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-023", "RM-050", "RM-017", "RM-031", "RM-035", "RM-055", "RM-053", "RM-025", "RM-015", "RM-052", "RM-020", "RM-021", "RM-026", "RM-049", "RM-044", "RM-037", "RM-013", "RM-030", "RM-027", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-041", "RM-014", "RM-032", "RM-028", "RM-040", "RM-042", "RM-046", "RM-048", "RM-039"]}, "RM-011": {"ancestors": ["RM-002", "RM-005", "RM-006", "RM-009", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-046", "RM-049", "RM-019", "RM-030", "RM-050", "RM-012", "RM-040"]}, "RM-012": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-011", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-013": {"ancestors": ["RM-002", "RM-005", "RM-006", "RM-009", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-019", "RM-029", "RM-050", "RM-017", "RM-031", "RM-035", "RM-053", "RM-025", "RM-015", "RM-052", "RM-020", "RM-049", "RM-044", "RM-030", "RM-027", "RM-018", "RM-016", "RM-047", "RM-041", "RM-014", "RM-032", "RM-028", "RM-040", "RM-046", "RM-048", "RM-039"]}, "RM-014": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-046", "RM-044", "RM-053", "RM-019", "RM-029", "RM-030", "RM-027", "RM-050", "RM-018", "RM-017", "RM-052", "RM-028", "RM-039"]}, "RM-015": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-016": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-020", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-017": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-053", "RM-029", "RM-030", "RM-050", "RM-039"]}, "RM-018": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050", "RM-030"]}, "RM-019": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-013", "RM-011", "RM-001", "RM-010", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050", "RM-046", "RM-030"]}, "RM-020": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-046", "RM-044", "RM-053", "RM-029", "RM-027", "RM-050", "RM-016", "RM-028", "RM-039"]}, "RM-021": {"ancestors": ["RM-002", "RM-022", "RM-006", "RM-009", "RM-005", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-023", "RM-050", "RM-031", "RM-035", "RM-053", "RM-025", "RM-052", "RM-026", "RM-044", "RM-049", "RM-037", "RM-027", "RM-036", "RM-047", "RM-041", "RM-028", "RM-040", "RM-042", "RM-046", "RM-048"]}, "RM-022": {"ancestors": ["RM-002", "RM-005", "RM-006", "RM-009", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-023", "RM-050", "RM-031", "RM-035", "RM-053", "RM-025", "RM-052", "RM-021", "RM-026", "RM-044", "RM-049", "RM-037", "RM-027", "RM-036", "RM-047", "RM-041", "RM-028", "RM-040", "RM-042", "RM-046", "RM-048"]}, "RM-023": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-009", "RM-005", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-024", "RM-050", "RM-031", "RM-035", "RM-053", "RM-025", "RM-052", "RM-026", "RM-044", "RM-049", "RM-037", "RM-027", "RM-036", "RM-047", "RM-041", "RM-028", "RM-046", "RM-048"]}, "RM-024": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-009", "RM-005", "RM-013", "RM-023", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-044", "RM-053", "RM-025", "RM-027", "RM-050", "RM-052", "RM-031", "RM-028"]}, "RM-025": {"ancestors": ["RM-002", "RM-021", "RM-024", "RM-022", "RM-006", "RM-009", "RM-005", "RM-013", "RM-023", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-026": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-009", "RM-005", "RM-023", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-027": {"ancestors": ["RM-002", "RM-021", "RM-024", "RM-022", "RM-006", "RM-009", "RM-005", "RM-013", "RM-023", "RM-001", "RM-010", "RM-020", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050", "RM-028", "RM-044"]}, "RM-028": {"ancestors": ["RM-002", "RM-021", "RM-024", "RM-033", "RM-022", "RM-009", "RM-006", "RM-005", "RM-013", "RM-001", "RM-023", "RM-027", "RM-010", "RM-020", "RM-034", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-029": {"ancestors": ["RM-002", "RM-033", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-017", "RM-020", "RM-034", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050", "RM-053", "RM-039"]}, "RM-030": {"ancestors": ["RM-002", "RM-033", "RM-019", "RM-009", "RM-006", "RM-005", "RM-013", "RM-011", "RM-001", "RM-010", "RM-018", "RM-017", "RM-004", "RM-034", "RM-014", "RM-032", "RM-003"], "descendants": ["RM-050"]}, "RM-031": {"ancestors": ["RM-002", "RM-021", "RM-024", "RM-022", "RM-033", "RM-009", "RM-006", "RM-005", "RM-013", "RM-023", "RM-001", "RM-010", "RM-034", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-032": {"ancestors": ["RM-002", "RM-033", "RM-006", "RM-009", "RM-005", "RM-013", "RM-001", "RM-010", "RM-034", "RM-004", "RM-003"], "descendants": ["RM-050", "RM-030", "RM-047"]}, "RM-033": {"ancestors": [], "descendants": ["RM-051", "RM-053", "RM-029", "RM-030", "RM-050", "RM-052", "RM-031", "RM-047", "RM-034", "RM-032", "RM-028", "RM-045", "RM-039"]}, "RM-034": {"ancestors": ["RM-033"], "descendants": ["RM-051", "RM-053", "RM-029", "RM-030", "RM-050", "RM-052", "RM-031", "RM-047", "RM-032", "RM-028", "RM-045", "RM-039"]}, "RM-035": {"ancestors": ["RM-002", "RM-021", "RM-043", "RM-022", "RM-006", "RM-005", "RM-009", "RM-013", "RM-023", "RM-001", "RM-010", "RM-041", "RM-004", "RM-003"], "descendants": ["RM-050", "RM-043", "RM-048"]}, "RM-036": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-009", "RM-005", "RM-023", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-050", "RM-037", "RM-046", "RM-047"]}, "RM-037": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-009", "RM-005", "RM-023", "RM-001", "RM-010", "RM-036", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-038": {"ancestors": ["RM-002", "RM-005", "RM-001", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-039": {"ancestors": ["RM-002", "RM-033", "RM-006", "RM-009", "RM-005", "RM-029", "RM-013", "RM-001", "RM-010", "RM-017", "RM-020", "RM-034", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-040": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-009", "RM-005", "RM-013", "RM-011", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-041": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-005", "RM-006", "RM-009", "RM-013", "RM-023", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-043", "RM-049", "RM-050", "RM-048", "RM-035"]}, "RM-042": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-009", "RM-005", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-043": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-006", "RM-005", "RM-009", "RM-003", "RM-013", "RM-023", "RM-001", "RM-010", "RM-041", "RM-004", "RM-035"], "descendants": ["RM-050", "RM-048", "RM-035"]}, "RM-044": {"ancestors": ["RM-002", "RM-021", "RM-024", "RM-022", "RM-006", "RM-009", "RM-005", "RM-013", "RM-023", "RM-001", "RM-027", "RM-010", "RM-020", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-045": {"ancestors": ["RM-034", "RM-033"], "descendants": ["RM-050"]}, "RM-046": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-019", "RM-009", "RM-006", "RM-005", "RM-011", "RM-023", "RM-013", "RM-001", "RM-010", "RM-036", "RM-020", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-047": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-033", "RM-009", "RM-006", "RM-005", "RM-013", "RM-023", "RM-001", "RM-010", "RM-036", "RM-034", "RM-032", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-048": {"ancestors": ["RM-002", "RM-021", "RM-043", "RM-022", "RM-006", "RM-005", "RM-009", "RM-003", "RM-013", "RM-023", "RM-001", "RM-010", "RM-041", "RM-004", "RM-035"], "descendants": ["RM-050"]}, "RM-049": {"ancestors": ["RM-002", "RM-021", "RM-022", "RM-005", "RM-006", "RM-009", "RM-011", "RM-013", "RM-023", "RM-001", "RM-010", "RM-041", "RM-004", "RM-003"], "descendants": ["RM-050"]}, "RM-050": {"ancestors": ["RM-043", "RM-024", "RM-022", "RM-019", "RM-029", "RM-011", "RM-001", "RM-023", "RM-007", "RM-017", "RM-031", "RM-004", "RM-038", "RM-035", "RM-005", "RM-025", "RM-015", "RM-020", "RM-045", "RM-003", "RM-021", "RM-026", "RM-044", "RM-033", "RM-049", "RM-037", "RM-013", "RM-030", "RM-027", "RM-010", "RM-018", "RM-016", "RM-036", "RM-012", "RM-047", "RM-034", "RM-014", "RM-032", "RM-028", "RM-041", "RM-040", "RM-042", "RM-002", "RM-046", "RM-006", "RM-009", "RM-008", "RM-048", "RM-039"], "descendants": []}, "RM-051": {"ancestors": ["RM-034", "RM-001", "RM-033"], "descendants": ["RM-052", "RM-053"]}, "RM-052": {"ancestors": ["RM-002", "RM-021", "RM-051", "RM-024", "RM-022", "RM-033", "RM-009", "RM-006", "RM-005", "RM-013", "RM-023", "RM-001", "RM-010", "RM-034", "RM-014", "RM-004", "RM-003"], "descendants": ["RM-053"]}, "RM-053": {"ancestors": ["RM-024", "RM-022", "RM-029", "RM-001", "RM-023", "RM-017", "RM-004", "RM-005", "RM-052", "RM-020", "RM-003", "RM-021", "RM-033", "RM-013", "RM-010", "RM-034", "RM-014", "RM-002", "RM-051", "RM-006", "RM-009"], "descendants": []}, "RM-054": {"ancestors": ["RM-002", "RM-006", "RM-005", "RM-009", "RM-001", "RM-004", "RM-003"], "descendants": []}, "RM-055": {"ancestors": ["RM-002", "RM-006", "RM-009", "RM-005", "RM-001", "RM-010", "RM-004", "RM-003"], "descendants": []}};
        const areaColors = {"Ingesta": "#4ECDC4", "Extracci\u00f3n": "#FF6B6B", "Modelo de datos": "#45B7D1", "Normalizaci\u00f3n": "#96CEB4", "Transformaci\u00f3n": "#96CEB4", "M\u00e9tricas": "#FFD93D", "Dataset": "#DDA0DD", "Algoritmo": "#98D8C8", "Backtest": "#F7DC6F", "Reportes": "#BB8FCE", "UI/UX": "#85C1E9", "Dashboard": "#85C1E9", "Seguridad": "#F1948A", "Observabilidad": "#ABEBC6", "Testing": "#F5B041", "DevOps": "#AED6F1", "Gobernanza de datos": "#D7BDE2", "Gobernanza": "#D7BDE2", "Privacidad": "#FADBD8", "Documentaci\u00f3n": "#D5DBDB", "Extensibilidad": "#A9DFBF", "Entregables": "#FAD7A0", "UX": "#85C1E9", "Calidad de datos": "#82E0AA", "Auditabilidad": "#F9E79F", "Exportaci\u00f3n": "#D2B4DE", "Reproducibilidad": "#AEB6BF", "Performance": "#F5CBA7", "Validaci\u00f3n de algoritmo": "#76D7C4"};
        const totalNodes = 55;
        const totalEdges = 166;
        const hasCycles = true;
        const cycles = [["RM-043", "RM-035"]];
        const cycleNodeCount = 2;

        // State
        let selectedNodeId = null;
        let currentLayout = 'force';
        let visibleNodeIds = new Set(Object.keys(nodeData));
        let currentViewContext = { type: 'all', node: null };
        let sortState = { column: 'id', direction: 'asc' };
        let autocompleteIndex = -1;

        // Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icons = { success: '‚úì', error: '‚úó', warning: '‚ö†', info: '‚Ñπ' };
            toast.innerHTML = `<span class="toast-icon">${icons[type] || icons.info}</span><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // Wait for network to be ready
        function waitForNetwork(callback) {
            if (typeof network !== 'undefined' && network) {
                callback();
            } else {
                setTimeout(() => waitForNetwork(callback), 100);
            }
        }

        // Initialize when ready
        waitForNetwork(function() {
            console.log('Network ready, initializing custom controls...');
            initializeApp();
        });

        function initializeApp() {
            // Initial renders
            updateTable();
            updateStatsPanel();

            // Bind event handlers
            bindEventHandlers();

            // Setup network event handlers
            setupNetworkHandlers();

            // Setup keyboard shortcuts
            setupKeyboardShortcuts();

            // Setup autocomplete
            setupAutocomplete();

            // Show cycle warning if cycles detected
            if (hasCycles) {
                document.getElementById('cycle-warning').classList.add('visible');
                showToast(`‚ö†Ô∏è Se detectaron ${cycles.length} ciclos de dependencias`, 'warning', 5000);
            }

            showToast('Visualizaci√≥n cargada correctamente', 'success');
        }

        function bindEventHandlers() {
            // Search button
            document.getElementById('btn-search').addEventListener('click', focusNode);

            // Search input enter key
            document.getElementById('node-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const dropdown = document.getElementById('autocomplete-dropdown');
                    if (dropdown.classList.contains('visible') && autocompleteIndex >= 0) {
                        const items = dropdown.querySelectorAll('.autocomplete-item');
                        if (items[autocompleteIndex]) {
                            items[autocompleteIndex].click();
                            return;
                        }
                    }
                    focusNode();
                }
            });

            // Filter dropdowns
            document.getElementById('area-filter').addEventListener('change', applyFilters);
            document.getElementById('priority-filter').addEventListener('change', applyFilters);
            document.getElementById('version-filter').addEventListener('change', applyFilters);

            // Exploration buttons
            document.getElementById('btn-ancestors').addEventListener('click', showAncestors);
            document.getElementById('btn-descendants').addEventListener('click', showDescendants);
            document.getElementById('btn-neighborhood').addEventListener('click', showNeighborhood);

            // Layout buttons
            document.getElementById('layout-force').addEventListener('click', () => setLayout('force'));
            document.getElementById('layout-tree').addEventListener('click', () => setLayout('tree'));

            // Reset button
            document.getElementById('btn-reset').addEventListener('click', resetView);

            // Breadcrumb reset
            document.getElementById('breadcrumb-reset').addEventListener('click', resetView);

            // Legend clicks
            document.querySelectorAll('.legend-item').forEach(item => {
                item.addEventListener('click', function() {
                    const area = this.getAttribute('data-area');
                    document.getElementById('area-filter').value = area;
                    applyFilters();
                });
            });

            // Export buttons
            document.getElementById('btn-export-png').addEventListener('click', exportPNG);
            document.getElementById('btn-export-csv').addEventListener('click', exportCSV);

            // Stats panel toggle
            document.getElementById('stats-toggle').addEventListener('click', function() {
                const content = document.getElementById('stats-content');
                const isCollapsed = content.classList.toggle('collapsed');
                this.textContent = isCollapsed ? '‚ñ∂' : '‚ñº';
            });

            // Sortable table headers
            document.querySelectorAll('.data-table th.sortable').forEach(th => {
                th.addEventListener('click', function() {
                    const column = this.dataset.sort;
                    if (sortState.column === column) {
                        sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortState.column = column;
                        sortState.direction = 'asc';
                    }
                    updateSortIndicators();
                    updateTable();
                });
            });

            // Keyboard shortcuts modal
            document.getElementById('btn-shortcuts').addEventListener('click', () => {
                document.getElementById('shortcuts-modal').classList.add('visible');
            });
            document.getElementById('modal-close').addEventListener('click', () => {
                document.getElementById('shortcuts-modal').classList.remove('visible');
            });
            document.getElementById('shortcuts-modal').addEventListener('click', function(e) {
                if (e.target === this) this.classList.remove('visible');
            });

            // Cycle warning button
            document.getElementById('btn-show-cycles').addEventListener('click', showCycleNodes);
        }

        function showCycleNodes() {
            if (!hasCycles || cycles.length === 0) {
                showToast('No se encontraron ciclos de dependencias', 'info');
                return;
            }

            // Get all nodes involved in cycles
            const cycleNodeIds = new Set();
            cycles.forEach(cycle => cycle.forEach(nodeId => cycleNodeIds.add(nodeId)));

            visibleNodeIds = cycleNodeIds;
            currentViewContext = { type: 'cycles', count: cycles.length };
            updateVisibility();
            updateTable();
            updateStats();
            updateBreadcrumb();
            updateStatsPanel();

            // Update breadcrumb manually for cycles
            document.getElementById('breadcrumb-text').innerHTML = `Nodos en ciclos (<strong>${cycleNodeIds.size}</strong> nodos, ${cycles.length} ciclos)`;
            document.getElementById('breadcrumb-reset').style.display = 'block';

            showToast(`Mostrando ${cycleNodeIds.size} nodos involucrados en ${cycles.length} ciclos`, 'warning');
        }

        function setupNetworkHandlers() {
            // Tooltip element
            const tooltip = document.getElementById('hover-tooltip');
            let tooltipPinned = false;

            // Click handler - pins the tooltip
            network.on('click', function(params) {
                if (params.nodes.length > 0) {
                    selectedNodeId = params.nodes[0];
                    showSelectedInfo(selectedNodeId);

                    // Pin the tooltip for clicked node
                    const data = nodeData[selectedNodeId];
                    if (data) {
                        const color = areaColors[data.area] || '#888888';
                        tooltip.innerHTML = `
                            <h4 style="color: ${color}">${selectedNodeId}: ${data.funcionalidad}</h4>
                            <div class="tooltip-row">
                                <span class="tooltip-label">√Årea:</span>
                                <span class="tooltip-value">${data.area}</span>
                            </div>
                            <div class="tooltip-row">
                                <span class="tooltip-label">Prioridad:</span>
                                <span class="tooltip-value">${data.prioridad}</span>
                            </div>
                            <div class="tooltip-row">
                                <span class="tooltip-label">Versi√≥n:</span>
                                <span class="tooltip-value">${data.version}</span>
                            </div>
                            <div class="tooltip-row">
                                <span class="tooltip-label">Owner:</span>
                                <span class="tooltip-value">${data.owner}</span>
                            </div>
                            <div class="tooltip-row">
                                <span class="tooltip-label">Dependencias:</span>
                                <span class="tooltip-value">${data.dependencias}</span>
                            </div>
                            <div class="tooltip-requisito">${data.requisito}</div>
                            <div class="tooltip-pinned-badge">üìå Fijado (clic en vac√≠o para cerrar)</div>
                        `;
                        tooltip.style.display = 'block';
                        tooltip.classList.add('pinned');
                        tooltipPinned = true;
                    }
                } else {
                    // Clicked on empty space - unpin and hide
                    selectedNodeId = null;
                    hideSelectedInfo();
                    tooltipPinned = false;
                    tooltip.classList.remove('pinned');
                    tooltip.style.display = 'none';
                }
            });

            // Hover tooltip
            network.on('hoverNode', function(params) {
                if (tooltipPinned) return; // Don't update if pinned

                const nodeId = params.node;
                const data = nodeData[nodeId];
                if (!data) return;

                const color = areaColors[data.area] || '#888888';
                tooltip.innerHTML = `
                    <h4 style="color: ${color}">${nodeId}: ${data.funcionalidad}</h4>
                    <div class="tooltip-row">
                        <span class="tooltip-label">√Årea:</span>
                        <span class="tooltip-value">${data.area}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Prioridad:</span>
                        <span class="tooltip-value">${data.prioridad}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Versi√≥n:</span>
                        <span class="tooltip-value">${data.version}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Owner:</span>
                        <span class="tooltip-value">${data.owner}</span>
                    </div>
                    <div class="tooltip-row">
                        <span class="tooltip-label">Dependencias:</span>
                        <span class="tooltip-value">${data.dependencias}</span>
                    </div>
                    <div class="tooltip-requisito">${data.requisito}</div>
                `;
                tooltip.style.display = 'block';
            });

            network.on('blurNode', function() {
                if (!tooltipPinned) {
                    tooltip.style.display = 'none';
                }
            });

            // Tooltip follows mouse only when not pinned
            document.querySelector('.graph-panel').addEventListener('mousemove', function(e) {
                if (tooltip.style.display === 'block' && !tooltipPinned) {
                    const x = e.clientX + 15;
                    const y = e.clientY + 15;
                    const rect = tooltip.getBoundingClientRect();
                    const maxX = window.innerWidth - rect.width - 20;
                    const maxY = window.innerHeight - rect.height - 20;
                    tooltip.style.left = Math.min(x, maxX) + 'px';
                    tooltip.style.top = Math.min(y, maxY) + 'px';
                }
            });
        }

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Don't trigger when typing in input fields
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                    if (e.key === 'Escape') {
                        e.target.blur();
                        document.getElementById('autocomplete-dropdown').classList.remove('visible');
                    }
                    return;
                }

                const modal = document.getElementById('shortcuts-modal');

                switch(e.key) {
                    case '?':
                        modal.classList.toggle('visible');
                        break;
                    case 'Escape':
                        if (modal.classList.contains('visible')) {
                            modal.classList.remove('visible');
                        } else {
                            resetView();
                        }
                        break;
                    case '/':
                        e.preventDefault();
                        document.getElementById('node-search').focus();
                        break;
                    case 'r':
                    case 'R':
                        resetView();
                        break;
                    case '1':
                        setLayout('force');
                        showToast('Disposici√≥n: Fuerza', 'info', 1500);
                        break;
                    case '2':
                        setLayout('tree');
                        showToast('Disposici√≥n: √Årbol', 'info', 1500);
                        break;
                    case 'a':
                    case 'A':
                        if (selectedNodeId) showAncestors();
                        break;
                    case 'd':
                    case 'D':
                        if (selectedNodeId) showDescendants();
                        break;
                    case 'n':
                    case 'N':
                        if (selectedNodeId) showNeighborhood();
                        break;
                }
            });
        }

        // Autocomplete
        function setupAutocomplete() {
            const input = document.getElementById('node-search');
            const dropdown = document.getElementById('autocomplete-dropdown');

            input.addEventListener('input', function() {
                const query = this.value.trim().toLowerCase();
                if (query.length < 2) {
                    dropdown.classList.remove('visible');
                    return;
                }

                const matches = [];
                Object.keys(nodeData).forEach(id => {
                    const data = nodeData[id];
                    const idMatch = id.toLowerCase().includes(query);
                    const funcMatch = data.funcionalidad.toLowerCase().includes(query);
                    const reqMatch = data.requisito.toLowerCase().includes(query);
                    if (idMatch || funcMatch || reqMatch) {
                        matches.push({ id, data, idMatch, funcMatch, reqMatch });
                    }
                });

                if (matches.length === 0) {
                    dropdown.classList.remove('visible');
                    return;
                }

                // Sort: ID matches first, then func matches, then req matches
                matches.sort((a, b) => {
                    if (a.idMatch && !b.idMatch) return -1;
                    if (!a.idMatch && b.idMatch) return 1;
                    if (a.funcMatch && !b.funcMatch) return -1;
                    if (!a.funcMatch && b.funcMatch) return 1;
                    return a.id.localeCompare(b.id);
                });

                dropdown.innerHTML = matches.slice(0, 10).map((m, i) => `
                    <div class="autocomplete-item" data-id="${m.id}">
                        <span class="autocomplete-id">${m.id}</span>
                        <span class="autocomplete-func">${m.data.funcionalidad.substring(0, 40)}${m.data.funcionalidad.length > 40 ? '...' : ''}</span>
                    </div>
                `).join('');

                dropdown.classList.add('visible');
                autocompleteIndex = -1;

                dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const id = this.dataset.id;
                        input.value = id;
                        dropdown.classList.remove('visible');
                        focusOnNode(id);
                    });
                });
            });

            input.addEventListener('keydown', function(e) {
                const items = dropdown.querySelectorAll('.autocomplete-item');
                if (!dropdown.classList.contains('visible') || items.length === 0) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    autocompleteIndex = Math.min(autocompleteIndex + 1, items.length - 1);
                    updateAutocompleteSelection(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    autocompleteIndex = Math.max(autocompleteIndex - 1, 0);
                    updateAutocompleteSelection(items);
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.classList.remove('visible');
                }
            });
        }

        function updateAutocompleteSelection(items) {
            items.forEach((item, i) => {
                item.classList.toggle('selected', i === autocompleteIndex);
            });
        }

        function focusOnNode(nodeId) {
            if (nodeData[nodeId]) {
                network.focus(nodeId, {
                    scale: 1.5,
                    animation: { duration: 500, easingFunction: 'easeInOutQuad' }
                });
                network.selectNodes([nodeId]);
                selectedNodeId = nodeId;
                showSelectedInfo(nodeId);
                showToast(`Enfocando en ${nodeId}`, 'success', 1500);
            }
        }

        function focusNode() {
            const input = document.getElementById('node-search').value.trim();
            if (!input) {
                showToast('Por favor ingresa un ID o texto de b√∫squeda', 'warning');
                return;
            }

            const upperInput = input.toUpperCase();

            // First try exact ID match
            if (nodeData[upperInput]) {
                focusOnNode(upperInput);
                return;
            }

            // Try full-text search
            const query = input.toLowerCase();
            const matches = [];
            Object.keys(nodeData).forEach(id => {
                const data = nodeData[id];
                if (id.toLowerCase().includes(query) ||
                    data.funcionalidad.toLowerCase().includes(query) ||
                    data.requisito.toLowerCase().includes(query)) {
                    matches.push(id);
                }
            });

            if (matches.length === 1) {
                focusOnNode(matches[0]);
            } else if (matches.length > 1) {
                // Filter to show only matches
                visibleNodeIds = new Set(matches);
                currentViewContext = { type: 'search', query: input, count: matches.length };
                updateVisibility();
                updateTable();
                updateStats();
                updateBreadcrumb();
                updateStatsPanel();
                showToast(`Encontrados ${matches.length} resultados para "${input}"`, 'info');
            } else {
                showToast(`No se encontr√≥: "${input}"`, 'error');
            }
        }

        function applyFilters() {
            const areaFilter = document.getElementById('area-filter').value;
            const priorityFilter = document.getElementById('priority-filter').value;
            const versionFilter = document.getElementById('version-filter').value;

            visibleNodeIds = new Set();

            Object.keys(nodeData).forEach(nodeId => {
                const data = nodeData[nodeId];
                const matchArea = !areaFilter || data.area === areaFilter;
                const matchPriority = !priorityFilter || data.prioridad === priorityFilter;
                const matchVersion = !versionFilter || data.version === versionFilter;

                if (matchArea && matchPriority && matchVersion) {
                    visibleNodeIds.add(nodeId);
                }
            });

            currentViewContext = { type: 'filter', area: areaFilter, priority: priorityFilter, version: versionFilter };
            updateVisibility();
            updateTable();
            updateStats();
            updateFilterChips();
            updateBreadcrumb();
            updateStatsPanel();
        }

        function updateVisibility() {
            const nodeUpdates = Object.keys(nodeData).map(id => ({
                id: id,
                hidden: !visibleNodeIds.has(id)
            }));
            nodes.update(nodeUpdates);

            const edgeUpdates = edges.get().map(edge => ({
                id: edge.id,
                hidden: !visibleNodeIds.has(edge.from) || !visibleNodeIds.has(edge.to)
            }));
            edges.update(edgeUpdates);

            setTimeout(() => {
                network.fit({ animation: { duration: 300 } });
            }, 100);
        }

        function updateTable() {
            const tbody = document.getElementById('table-body');

            // Get sorted IDs based on sortState
            let sortedData = Array.from(visibleNodeIds).map(id => ({
                id,
                ...nodeData[id],
                connections: nodeData[id].in_degree + nodeData[id].out_degree
            }));

            sortedData.sort((a, b) => {
                let aVal, bVal;
                switch (sortState.column) {
                    case 'id':
                        aVal = a.id;
                        bVal = b.id;
                        break;
                    case 'area':
                        aVal = a.area;
                        bVal = b.area;
                        break;
                    case 'funcionalidad':
                        aVal = a.funcionalidad;
                        bVal = b.funcionalidad;
                        break;
                    case 'prioridad':
                        const priorityOrder = { 'Alta (P0)': 0, 'Media (P1)': 1, 'Baja (P2)': 2 };
                        aVal = priorityOrder[a.prioridad] ?? 1;
                        bVal = priorityOrder[b.prioridad] ?? 1;
                        break;
                    case 'version':
                        aVal = a.version;
                        bVal = b.version;
                        break;
                    case 'connections':
                        aVal = a.connections;
                        bVal = b.connections;
                        break;
                    default:
                        aVal = a.id;
                        bVal = b.id;
                }

                if (typeof aVal === 'number') {
                    return sortState.direction === 'asc' ? aVal - bVal : bVal - aVal;
                }
                return sortState.direction === 'asc' ?
                    String(aVal).localeCompare(String(bVal)) :
                    String(bVal).localeCompare(String(aVal));
            });

            let html = '';
            sortedData.forEach(item => {
                const priorityClass = item.prioridad.includes('P0') ? 'priority-p0' :
                                      item.prioridad.includes('P1') ? 'priority-p1' : 'priority-p2';

                html += `
                    <tr data-id="${item.id}" style="cursor: pointer;">
                        <td class="id-cell">${item.id}</td>
                        <td class="area-cell">${item.area}</td>
                        <td class="func-cell">${item.funcionalidad}</td>
                        <td><span class="priority-badge ${priorityClass}">${item.prioridad}</span></td>
                        <td>${item.version}</td>
                        <td style="text-align:center">${item.connections}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
            document.getElementById('table-count').textContent = visibleNodeIds.size + ' requisitos';

            // Add click handlers to table rows
            tbody.querySelectorAll('tr').forEach(row => {
                row.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    network.focus(id, {
                        scale: 1.5,
                        animation: { duration: 500 }
                    });
                    network.selectNodes([id]);
                    selectedNodeId = id;
                    showSelectedInfo(id);
                });
            });
        }

        function updateSortIndicators() {
            document.querySelectorAll('.data-table th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.dataset.sort === sortState.column) {
                    th.classList.add(sortState.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                    th.querySelector('.sort-indicator').textContent = sortState.direction === 'asc' ? '‚ñ≤' : '‚ñº';
                } else {
                    th.querySelector('.sort-indicator').textContent = '‚áÖ';
                }
            });
        }

        function updateStats() {
            document.getElementById('visible-nodes').textContent = visibleNodeIds.size;
            const visibleEdgeCount = edges.get().filter(e =>
                visibleNodeIds.has(e.from) && visibleNodeIds.has(e.to)
            ).length;
            document.getElementById('visible-edges').textContent = visibleEdgeCount;
        }

        function updateFilterChips() {
            const container = document.getElementById('filter-chips');
            const chips = [];
            const areaFilter = document.getElementById('area-filter').value;
            const priorityFilter = document.getElementById('priority-filter').value;
            const versionFilter = document.getElementById('version-filter').value;

            if (areaFilter) {
                chips.push({ type: 'area', label: '√Årea', value: areaFilter });
            }
            if (priorityFilter) {
                chips.push({ type: 'priority', label: 'Prioridad', value: priorityFilter });
            }
            if (versionFilter) {
                chips.push({ type: 'version', label: 'Versi√≥n', value: versionFilter });
            }

            container.innerHTML = chips.map(chip => `
                <div class="filter-chip" data-type="${chip.type}">
                    <span class="filter-chip-label">${chip.label}:</span>
                    <span>${chip.value}</span>
                    <button class="filter-chip-remove" data-type="${chip.type}">&times;</button>
                </div>
            `).join('');

            container.querySelectorAll('.filter-chip-remove').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.type;
                    if (type === 'area') document.getElementById('area-filter').value = '';
                    if (type === 'priority') document.getElementById('priority-filter').value = '';
                    if (type === 'version') document.getElementById('version-filter').value = '';
                    applyFilters();
                });
            });
        }

        function updateBreadcrumb() {
            const textEl = document.getElementById('breadcrumb-text');
            const resetBtn = document.getElementById('breadcrumb-reset');
            const ctx = currentViewContext;

            if (ctx.type === 'all') {
                textEl.innerHTML = `Todos los requisitos (<strong>${totalNodes}</strong>)`;
                resetBtn.style.display = 'none';
            } else if (ctx.type === 'filter') {
                const parts = [];
                if (ctx.area) parts.push(ctx.area);
                if (ctx.priority) parts.push(ctx.priority);
                if (ctx.version) parts.push(ctx.version);
                textEl.innerHTML = `Filtrado: ${parts.join(', ')} (<strong>${visibleNodeIds.size}</strong>)`;
                resetBtn.style.display = 'block';
            } else if (ctx.type === 'ancestors') {
                textEl.innerHTML = `Ancestros de <strong>${ctx.node}</strong> (${visibleNodeIds.size})`;
                resetBtn.style.display = 'block';
            } else if (ctx.type === 'descendants') {
                textEl.innerHTML = `Descendientes de <strong>${ctx.node}</strong> (${visibleNodeIds.size})`;
                resetBtn.style.display = 'block';
            } else if (ctx.type === 'neighborhood') {
                textEl.innerHTML = `Vecindario de <strong>${ctx.node}</strong> (${visibleNodeIds.size})`;
                resetBtn.style.display = 'block';
            } else if (ctx.type === 'search') {
                textEl.innerHTML = `B√∫squeda: "${ctx.query}" (<strong>${ctx.count}</strong> resultados)`;
                resetBtn.style.display = 'block';
            }
        }

        function updateStatsPanel() {
            // Priority distribution
            const priorityCounts = { 'Alta (P0)': 0, 'Media (P1)': 0, 'Baja (P2)': 0 };
            visibleNodeIds.forEach(id => {
                const p = nodeData[id].prioridad;
                if (priorityCounts[p] !== undefined) priorityCounts[p]++;
            });

            const priorityColors = { 'Alta (P0)': '#ff6b6b', 'Media (P1)': '#ffd93d', 'Baja (P2)': '#4ecdc4' };
            const maxPriority = Math.max(...Object.values(priorityCounts), 1);

            document.getElementById('priority-stats').innerHTML = Object.entries(priorityCounts).map(([label, count]) => `
                <div class="stats-bar-row">
                    <span class="stats-bar-label">${label.replace(' (P0)', '').replace(' (P1)', '').replace(' (P2)', '')}</span>
                    <div class="stats-bar-wrapper">
                        <div class="stats-bar" style="width: ${(count / maxPriority) * 100}%; background: ${priorityColors[label]}"></div>
                    </div>
                    <span class="stats-bar-value">${count}</span>
                </div>
            `).join('');

            // Area distribution (top 5)
            const areaCounts = {};
            visibleNodeIds.forEach(id => {
                const area = nodeData[id].area;
                areaCounts[area] = (areaCounts[area] || 0) + 1;
            });

            const topAreas = Object.entries(areaCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            const maxArea = topAreas.length > 0 ? topAreas[0][1] : 1;

            document.getElementById('area-stats').innerHTML = topAreas.map(([area, count]) => `
                <div class="stats-bar-row">
                    <span class="stats-bar-label" title="${area}">${area.substring(0, 12)}</span>
                    <div class="stats-bar-wrapper">
                        <div class="stats-bar" style="width: ${(count / maxArea) * 100}%; background: ${areaColors[area] || '#888'}"></div>
                    </div>
                    <span class="stats-bar-value">${count}</span>
                </div>
            `).join('');

            // Top connected nodes
            const connections = Array.from(visibleNodeIds).map(id => ({
                id,
                total: nodeData[id].in_degree + nodeData[id].out_degree
            })).sort((a, b) => b.total - a.total).slice(0, 5);

            document.getElementById('top-connected').innerHTML = connections.map(c => `
                <div class="top-connected-item" data-id="${c.id}">
                    <span class="top-connected-id">${c.id}</span>
                    <span>${nodeData[c.id].funcionalidad.substring(0, 20)}...</span>
                    <span class="top-connected-count">${c.total} conex.</span>
                </div>
            `).join('');

            // Click handlers for top connected items
            document.querySelectorAll('.top-connected-item').forEach(item => {
                item.addEventListener('click', function() {
                    focusOnNode(this.dataset.id);
                });
            });
        }

        // Export functions
        function exportPNG() {
            showToast('Generando imagen PNG...', 'info', 2000);
            try {
                const canvas = document.querySelector('#mynetwork canvas');
                if (!canvas) {
                    showToast('No se pudo encontrar el canvas del grafo', 'error');
                    return;
                }

                // Create a new canvas with white background and title
                const exportCanvas = document.createElement('canvas');
                const ctx = exportCanvas.getContext('2d');
                const padding = 40;

                exportCanvas.width = canvas.width + padding * 2;
                exportCanvas.height = canvas.height + padding * 2 + 50;

                // Dark background
                ctx.fillStyle = '#1a1a2e';
                ctx.fillRect(0, 0, exportCanvas.width, exportCanvas.height);

                // Title
                ctx.fillStyle = '#00ff88';
                ctx.font = 'bold 24px Segoe UI, Arial, sans-serif';
                ctx.fillText('Requirements Dependency Graph', padding, 35);

                // Timestamp
                ctx.fillStyle = '#8888aa';
                ctx.font = '12px Segoe UI, Arial, sans-serif';
                ctx.fillText(new Date().toLocaleString(), padding, 55);

                // Draw the original canvas
                ctx.drawImage(canvas, padding, padding + 50);

                // Create download link
                const link = document.createElement('a');
                link.download = `requirements-graph-${Date.now()}.png`;
                link.href = exportCanvas.toDataURL('image/png');
                link.click();

                showToast('PNG exportado correctamente', 'success');
            } catch (err) {
                showToast('Error al exportar PNG: ' + err.message, 'error');
            }
        }

        function exportCSV() {
            showToast('Generando archivo CSV...', 'info', 1500);
            try {
                const headers = ['ID', '√Årea', 'Funcionalidad', 'Prioridad', 'Versi√≥n', 'Owner', 'Estatus', 'Dependencias', 'In-Degree', 'Out-Degree'];
                const rows = [headers.join(',')];

                Array.from(visibleNodeIds).sort().forEach(id => {
                    const d = nodeData[id];
                    const row = [
                        id,
                        `"${d.area}"`,
                        `"${d.funcionalidad.replace(/"/g, '""')}"`,
                        `"${d.prioridad}"`,
                        `"${d.version}"`,
                        `"${d.owner}"`,
                        `"${d.estatus}"`,
                        `"${d.dependencias}"`,
                        d.in_degree,
                        d.out_degree
                    ];
                    rows.push(row.join(','));
                });

                // UTF-8 BOM for Excel compatibility
                const BOM = '\uFEFF';
                const csvContent = BOM + rows.join('\n');
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `requirements-${visibleNodeIds.size}-${Date.now()}.csv`;
                link.click();

                showToast(`CSV exportado (${visibleNodeIds.size} requisitos)`, 'success');
            } catch (err) {
                showToast('Error al exportar CSV: ' + err.message, 'error');
            }
        }

        function showSelectedInfo(nodeId) {
            // Info is now shown in the pinned tooltip
        }

        function hideSelectedInfo() {
            // Info is now hidden via the pinned tooltip
        }

        function showAncestors() {
            if (!selectedNodeId) {
                showToast('Primero selecciona un nodo haciendo clic en el grafo', 'warning');
                return;
            }
            const ancestors = subgraphData[selectedNodeId]?.ancestors || [];
            visibleNodeIds = new Set([selectedNodeId, ...ancestors]);
            currentViewContext = { type: 'ancestors', node: selectedNodeId };
            updateVisibility();
            updateTable();
            updateStats();
            updateBreadcrumb();
            updateStatsPanel();
            showToast(`Mostrando ${visibleNodeIds.size} ancestros de ${selectedNodeId}`, 'info');
        }

        function showDescendants() {
            if (!selectedNodeId) {
                showToast('Primero selecciona un nodo haciendo clic en el grafo', 'warning');
                return;
            }
            const descendants = subgraphData[selectedNodeId]?.descendants || [];
            visibleNodeIds = new Set([selectedNodeId, ...descendants]);
            currentViewContext = { type: 'descendants', node: selectedNodeId };
            updateVisibility();
            updateTable();
            updateStats();
            updateBreadcrumb();
            updateStatsPanel();
            showToast(`Mostrando ${visibleNodeIds.size} descendientes de ${selectedNodeId}`, 'info');
        }

        function showNeighborhood() {
            if (!selectedNodeId) {
                showToast('Primero selecciona un nodo haciendo clic en el grafo', 'warning');
                return;
            }
            const neighbors = new Set([selectedNodeId]);
            edges.get().forEach(edge => {
                if (edge.from === selectedNodeId) neighbors.add(edge.to);
                if (edge.to === selectedNodeId) neighbors.add(edge.from);
            });
            visibleNodeIds = neighbors;
            currentViewContext = { type: 'neighborhood', node: selectedNodeId };
            updateVisibility();
            updateTable();
            updateStats();
            updateBreadcrumb();
            updateStatsPanel();
            showToast(`Mostrando vecindario de ${selectedNodeId} (${visibleNodeIds.size} nodos)`, 'info');
        }

        function setLayout(layout) {
            currentLayout = layout;

            // Update button states
            document.getElementById('layout-force').classList.toggle('active', layout === 'force');
            document.getElementById('layout-tree').classList.toggle('active', layout === 'tree');

            if (layout === 'tree') {
                network.setOptions({
                    layout: {
                        hierarchical: {
                            enabled: true,
                            direction: 'UD',
                            sortMethod: 'directed',
                            levelSeparation: 100,
                            nodeSpacing: 120,
                            treeSpacing: 150,
                            blockShifting: true,
                            edgeMinimization: true,
                            parentCentralization: true
                        }
                    },
                    physics: {
                        enabled: false
                    }
                });
            } else {
                network.setOptions({
                    layout: {
                        hierarchical: {
                            enabled: false
                        }
                    },
                    physics: {
                        enabled: true,
                        solver: 'forceAtlas2Based',
                        forceAtlas2Based: {
                            gravitationalConstant: -80,
                            centralGravity: 0.01,
                            springLength: 150,
                            springConstant: 0.08,
                            damping: 0.4,
                            avoidOverlap: 0.8
                        }
                    }
                });
            }

            setTimeout(() => {
                network.fit({ animation: { duration: 500 } });
            }, 300);
        }

        function resetView() {
            // Clear filters
            document.getElementById('area-filter').value = '';
            document.getElementById('priority-filter').value = '';
            document.getElementById('version-filter').value = '';
            document.getElementById('node-search').value = '';

            // Show all nodes
            visibleNodeIds = new Set(Object.keys(nodeData));
            currentViewContext = { type: 'all', node: null };
            updateVisibility();
            updateTable();

            // Reset stats
            document.getElementById('visible-nodes').textContent = totalNodes;
            document.getElementById('visible-edges').textContent = totalEdges;

            // Clear filter chips
            document.getElementById('filter-chips').innerHTML = '';

            // Update breadcrumb
            updateBreadcrumb();

            // Update stats panel
            updateStatsPanel();

            // Deselect
            network.unselectAll();
            selectedNodeId = null;
            hideSelectedInfo();

            // Hide pinned tooltip
            const tooltip = document.getElementById('hover-tooltip');
            tooltip.style.display = 'none';
            tooltip.classList.remove('pinned');

            // Reset layout to force
            if (currentLayout === 'tree') {
                setLayout('force');
            }

            network.fit({ animation: { duration: 500 } });
            showToast('Vista restablecida', 'info', 1500);
        }
    })();
    </script>
    </body></html>